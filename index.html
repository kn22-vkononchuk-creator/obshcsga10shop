<!DOCTYPE html>
<html lang="uk">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ObshchagaSHOP</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'accent-blue': '#3b82f6',
                        'header-dark': '#1f2937',
                        'success-green': '#059669',
                        'light-bg': '#f9fafb',
                        'border-light': '#e5e7eb',
                        'warning-orange': '#f59e0b',
                        'danger-red': '#ef4444',
                        'info-blue': '#60a5fa', /* New color for info/new status */
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    boxShadow: {
                        'custom-light': '0 10px 30px rgba(0, 0, 0, 0.08)',
                        'custom-medium': '0 15px 40px rgba(0, 0, 0, 0.12)',
                    }
                }
            }
        }
    </script>
    <style>
        /* –ë–ê–ó–û–í–Ü –°–¢–ò–õ–Ü –¢–ê –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø TAILWIND */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: #f9fafb;
            color: #1f2937;
            line-height: 1.6;
        }

        header {
            background-color: #1f2937;
            color: white;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
            z-index: 50;
            position: sticky;
            top: 0;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: 900;
            letter-spacing: -0.03em;
            color: #fff;
            cursor: pointer;
            /* –î–æ–¥–∞–Ω–æ –¥–ª—è –∫–ª—ñ–∫–∞–±–µ–ª—å–Ω–æ—Å—Ç—ñ –ª–æ–≥–æ—Ç–∏–ø—É */
        }

        nav ul li a {
            transition: background-color 0.3s, color 0.3s, transform 0.2s;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            border-radius: 8px;
            padding: 0.6rem 1rem;
        }

        nav ul li a:hover,
        nav ul li a.active-link {
            background-color: #3b82f6;
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(59, 130, 246, 0.3);
        }

        .container {
            max-width: 1300px;
            margin: 2.5rem auto;
            padding: 0 1.5rem;
            /* MOBILE ADAPTATION: –ó–º–µ–Ω—à—É—î–º–æ –≤—ñ–¥—Å—Ç—É–ø–∏ –Ω–∞ –º–æ–±—ñ–ª—å–Ω–∏—Ö */
            padding: 0 1rem;
        }

        /* MOBILE ADAPTATION: –ó–º–µ–Ω—à—É—î–º–æ –≤–µ—Ä—Ö–Ω—ñ–π –≤—ñ–¥—Å—Ç—É–ø –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –Ω–∞ –º–æ–±—ñ–ª—å–Ω–∏—Ö */
        @media (max-width: 640px) {
            .container {
                margin-top: 1.5rem;
            }
        }


        .page {
            display: none;
            background-color: white;
            border-radius: 18px;
            box-shadow: 0 18px 50px rgba(0, 0, 0, 0.07);
            padding: 3rem;
            margin-top: 2rem;
            /* MOBILE ADAPTATION: –ó–º–µ–Ω—à—É—î–º–æ padding –Ω–∞ –º–æ–±—ñ–ª—å–Ω–∏—Ö */
            padding: 1.5rem;
        }

        /* MOBILE ADAPTATION: –ó–º–µ–Ω—à—É—î–º–æ margin-top —Å—Ç–æ—Ä—ñ–Ω–∫–∏ –Ω–∞ –º–æ–±—ñ–ª—å–Ω–∏—Ö */
        @media (max-width: 640px) {
            .page {
                margin-top: 1.5rem;
                border-radius: 12px;
                /* –¢—Ä–æ—Ö–∏ –º–µ–Ω—à–∏–π —Ä–∞–¥—ñ—É—Å */
            }
        }


        .page.active {
            display: block;
        }

        /* –ö–ê–†–¢–ö–ê –¢–û–í–ê–†–£ */
        .product-card {
            border: 1px solid #e5e7eb;
            border-radius: 16px;
            background-color: #fff;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            padding: 1.5rem;
            min-height: 420px;
            transition: min-height 0.3s ease, transform 0.3s ease-out, box-shadow 0.3s ease-out;
            overflow: hidden;
        }

        .product-card:hover {
            min-height: 520px;
            box-shadow: 0 25px 55px rgba(0, 0, 0, 0.15);
            transform: translateY(-8px);
        }

        /* MOBILE ADAPTATION: –ó–º–µ–Ω—à—É—î–º–æ min-height –Ω–∞ –º–æ–±—ñ–ª—å–Ω–∏—Ö */
        @media (max-width: 640px) {
            .product-card {
                min-height: 380px;
                padding: 1rem;
            }

            .product-card:hover {
                min-height: 450px;
                /* –ó–º–µ–Ω—à—É—î–º–æ –≤–∏—Å–æ—Ç—É –ø—Ä–∏ —Ö–æ–≤–µ—Ä—ñ –Ω–∞ –º–æ–±—ñ–ª—å–Ω–∏—Ö */
            }
        }


        /* –û–ø–∏—Å —Ç–æ–≤–∞—Ä—É, —â–æ –≤–∏—ó–∂–¥–∂–∞—î –ó–ù–ò–ó–£ */
        .product-description-wrapper {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease, padding-top 0.3s ease;
            font-size: 0.9rem;
            line-height: 1.4;
            color: #4b5563;
            margin-top: 0;
            padding-top: 0;
            text-align: left;
            width: 100%;
        }

        .product-card:hover .product-description-wrapper {
            max-height: 150px;
            padding-top: 1rem;
        }

        /* MOBILE ADAPTATION: –ó–º–µ–Ω—à—É—î–º–æ max-height –æ–ø–∏—Å—É –Ω–∞ –º–æ–±—ñ–ª—å–Ω–∏—Ö */
        @media (max-width: 640px) {
            .product-card:hover .product-description-wrapper {
                max-height: 100px;
                /* –ú–µ–Ω—à–µ –º—ñ—Å—Ü—è –¥–ª—è –æ–ø–∏—Å—É */
                font-size: 0.85rem;
            }
        }


        /* –°—Ç–∏–ª—ñ –¥–ª—è —Ü—ñ–Ω–∏ –∑—ñ –∑–Ω–∏–∂–∫–æ—é */
        .original-price {
            text-decoration: line-through;
            color: #6b7280;
            font-size: 0.9em;
            margin-right: 0.5rem;
        }

        .discount-badge {
            background-color: #ef4444;
            color: white;
            padding: 0.2rem 0.5rem;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 700;
            margin-left: 0.5rem;
        }

        /* –ö–û–†–ó–ò–ù–ê */
        #cart-count {
            position: absolute;
            top: -8px;
            right: -10px;
            background-color: #ef4444;
            color: white;
            border-radius: 50%;
            padding: 4px 9px;
            font-size: 0.85rem;
            font-weight: 700;
            opacity: 0;
            transform: scale(0);
            transition: opacity 0.3s, transform 0.3s;
            pointer-events: none;
            box-shadow: 0 2px 8px rgba(239, 68, 68, 0.4);
        }

        #cart-count.active {
            opacity: 1;
            transform: scale(1);
        }

        @keyframes bump {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.4);
            }
        }

        .cart-bump {
            animation: bump 0.3s ease-in-out;
        }

        /* –°–¢–ò–õ–¨ –ö–ù–û–ü–û–ö - –°—É—á–∞—Å–Ω–∏–π 3D */
        .primary-btn {
            background-color: #3b82f6;
            color: white;
            border: none;
            padding: 0.85rem 1.75rem;
            border-radius: 12px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.1s, box-shadow 0.3s;
            font-weight: 700;
            box-shadow: 0 6px 0 #2563eb;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .primary-btn:hover {
            background-color: #2563eb;
            transform: translateY(-3px);
            box-shadow: 0 9px 0 #1d4ed8;
        }

        .primary-btn:active {
            transform: translateY(2px);
            box-shadow: 0 3px 0 #1d4ed8;
        }

        /* DIALOG BOX */
        .dialog-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.75);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease-out;
        }

        .dialog-show {
            display: flex;
            opacity: 1;
        }

        .dialog-content {
            background: white;
            padding: 3rem;
            border-radius: 20px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.25);
            transform: scale(0.85);
            transition: transform 0.3s ease-out;
            /* MOBILE ADAPTATION: –ó–º–µ–Ω—à—É—î–º–æ padding —Ç–∞ —Ä–∞–¥—ñ—É—Å –Ω–∞ –º–æ–±—ñ–ª—å–Ω–∏—Ö */
            padding: 1.5rem;
            border-radius: 12px;
        }

        /* MOBILE ADAPTATION: –ó–±—ñ–ª—å—à—É—î–º–æ —à–∏—Ä–∏–Ω—É –º–æ–¥–∞–ª–∫–∏ –Ω–∞ –¥—É–∂–µ –º–∞–ª–∏—Ö –µ–∫—Ä–∞–Ω–∞—Ö */
        @media (max-width: 480px) {
            .dialog-content {
                width: 95%;
            }
        }


        .dialog-show .dialog-content {
            transform: scale(1);
        }

        /* SPINNER */
        #api-spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #ffffff;
            border-radius: 50%;
            width: 22px;
            height: 22px;
            animation: spin 0.8s linear infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* –î–æ–¥–∞—Ç–∫–æ–≤—ñ —Å—Ç–∏–ª—ñ –¥–ª—è –∞–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—ñ —Ç–∞ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ */
        .product-availability {
            font-size: 0.9rem;
            font-weight: 600;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            display: inline-block;
            margin-top: 0.5rem;
        }

        .product-availability.in-stock {
            background-color: #d1fae5;
            color: #065f46;
        }

        .product-availability.out-of-stock {
            background-color: #fee2e2;
            color: #991b1b;
        }

        .admin-product-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            background-color: #fff;
            padding: 0.75rem 1rem;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            border: 1px solid #e5e7eb;
            margin-bottom: 0.75rem;
            flex-wrap: wrap;
        }

        .admin-product-item:last-child {
            margin-bottom: 0;
        }

        .admin-product-item .product-details {
            flex-grow: 1;
            margin-right: 1rem;
            min-width: 150px;
            /* MOBILE ADAPTATION: –ó–º–µ–Ω—à—É—î–º–æ min-width –Ω–∞ –º–æ–±—ñ–ª—å–Ω–∏—Ö */
            min-width: 120px;
        }

        .admin-product-item .product-details .name {
            font-weight: 600;
            color: #1f2937;
        }

        .admin-product-item .product-details .price {
            font-size: 0.9rem;
            color: #059669;
        }

        .admin-product-item .product-details .id {
            font-size: 0.75rem;
            color: #6b7280;
        }

        .admin-product-item .controls {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            flex-wrap: wrap;
            justify-content: flex-end;
            /* MOBILE ADAPTATION: –ó–º—ñ–Ω—é—î–º–æ –≤–∏—Ä—ñ–≤–Ω—é–≤–∞–Ω–Ω—è –Ω–∞ –º–æ–±—ñ–ª—å–Ω–∏—Ö */
            justify-content: center;
            margin-top: 0.5rem;
        }

        /* MOBILE ADAPTATION: –ó–º–µ–Ω—à—É—î–º–æ –≤—ñ–¥—Å—Ç—É–ø–∏ –º—ñ–∂ –µ–ª–µ–º–µ–Ω—Ç–∞–º–∏ –∫–µ—Ä—É–≤–∞–Ω–Ω—è –Ω–∞ –º–æ–±—ñ–ª—å–Ω–∏—Ö */
        @media (max-width: 640px) {
            .admin-product-item .controls {
                gap: 0.5rem;
            }
        }


        .admin-product-item .controls input[type="number"] {
            padding: 0.4rem 0.6rem;
            border-radius: 8px;
            border: 1px solid #d1d5db;
            background-color: #f9fafb;
            font-size: 0.9rem;
            width: 70px;
            text-align: center;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        /* MOBILE ADAPTATION: –ó–º–µ–Ω—à—É—î–º–æ —à–∏—Ä–∏–Ω—É —ñ–Ω–ø—É—Ç—É –Ω–∞ –º–æ–±—ñ–ª—å–Ω–∏—Ö */
        @media (max-width: 640px) {
            .admin-product-item .controls input[type="number"] {
                width: 60px;
                padding: 0.3rem 0.5rem;
            }
        }


        .admin-product-item .controls input[type="number"]:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
            outline: none;
        }

        .admin-product-item .controls .delete-btn {
            background-color: #ef4444;
            color: white;
            padding: 0.5rem 0.8rem;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 600;
            transition: background-color 0.2s, transform 0.1s;
            box-shadow: 0 3px 0 #dc2626;
        }

        /* MOBILE ADAPTATION: –ó–º–µ–Ω—à—É—î–º–æ padding –∫–Ω–æ–ø–æ–∫ –Ω–∞ –º–æ–±—ñ–ª—å–Ω–∏—Ö */
        @media (max-width: 640px) {

            .admin-product-item .controls .delete-btn,
            .admin-product-item .controls .notify-btn,
            .admin-product-item .controls .edit-btn {
                padding: 0.4rem 0.6rem;
                font-size: 0.8rem;
            }
        }


        .admin-product-item .controls .delete-btn:hover {
            background-color: #dc2626;
            transform: translateY(-1px);
            box-shadow: 0 4px 0 #b91c1c;
        }

        .admin-product-item .controls .delete-btn:active {
            transform: translateY(2px);
            box-shadow: 0 1px 0 #b91c1c;
        }

        /* –°—Ç–∏–ª—ñ –¥–ª—è –∫–Ω–æ–ø–∫–∏ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è */
        .notify-btn {
            background-color: #10b981;
            color: white;
            padding: 0.5rem 0.8rem;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 600;
            transition: background-color 0.2s, transform 0.1s;
            box-shadow: 0 3px 0 #059669;
        }

        .notify-btn:hover {
            background-color: #059669;
            transform: translateY(-1px);
            box-shadow: 0 4px 0 #047857;
        }

        .notify-btn:active {
            transform: translateY(2px);
            box-shadow: 0 1px 0 #047857;
        }

        /* –°—Ç–∏–ª—ñ –¥–ª—è –∫–Ω–æ–ø–∫–∏ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è */
        .edit-btn {
            background-color: #f59e0b;
            /* Warning Orange */
            color: white;
            padding: 0.5rem 0.8rem;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 600;
            transition: background-color 0.2s, transform 0.1s;
            box-shadow: 0 3px 0 #d97706;
        }

        .edit-btn:hover {
            background-color: #d97706;
            transform: translateY(-1px);
            box-shadow: 0 4px 0 #b45309;
        }

        .edit-btn:active {
            transform: translateY(2px);
            box-shadow: 0 1px 0 #b45309;
        }

        /* –°—Ç–∏–ª—ñ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –≤–ª–∞—Å–Ω–æ–≥–æ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è (–∑–∞–≥–∞–ª—å–Ω–æ–≥–æ) */
        .general-notify-btn {
            background-color: #6366f1;
            /* Indigo */
            color: white;
            padding: 0.85rem 1.75rem;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 700;
            transition: background-color 0.2s, transform 0.1s;
            box-shadow: 0 6px 0 #4338ca;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .general-notify-btn:hover {
            background-color: #4338ca;
            transform: translateY(-3px);
            box-shadow: 0 9px 0 #3730a3;
        }

        .general-notify-btn:active {
            transform: translateY(2px);
            box-shadow: 0 3px 0 #3730a3;
        }

        /* Styles for customer list */
        .customer-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 1rem;
            background-color: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            margin-bottom: 0.5rem;
        }

        .customer-item:last-child {
            margin-bottom: 0;
        }

        .customer-item .customer-details {
            flex-grow: 1;
        }

        .customer-item .customer-details .username {
            font-weight: 600;
            color: #1f2937;
        }

        .customer-item .customer-details .chat-id {
            font-size: 0.85rem;
            color: #6b7280;
        }

        /* Styles for order list */
        .order-item {
            background-color: #fff;
            padding: 1rem;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            border: 1px solid #e5e7eb;
            margin-bottom: 0.75rem;
        }

        .order-item:last-child {
            margin-bottom: 0;
        }

        .order-item .order-header {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
            gap: 0.5rem;
        }

        .order-item .order-id {
            font-weight: 700;
            color: #1f2937;
            font-size: 1.1rem;
        }

        .order-item .order-status {
            font-weight: 600;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.85rem;
        }

        .order-item .order-status.New {
            background-color: #e0f2fe;
            /* light blue */
            color: #0284c7;
            /* sky blue */
        }

        .order-item .order-status.Confirmed {
            background-color: #d1fae5;
            /* light green */
            color: #065f46;
            /* dark green */
        }

        .order-item .order-status.Cancelled {
            background-color: #fee2e2;
            /* light red */
            color: #991b1b;
            /* dark red */
        }

        .order-item .order-details p {
            font-size: 0.9rem;
            color: #4b5563;
            margin-bottom: 0.25rem;
        }

        .order-item .order-items-summary {
            font-size: 0.85rem;
            color: #6b7280;
            margin-top: 0.5rem;
            padding-top: 0.5rem;
            border-top: 1px dashed #e5e7eb;
        }

        .order-item .order-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 1rem;
            justify-content: flex-end;
        }

        .order-item .order-actions .primary-btn {
            padding: 0.5rem 1rem;
            font-size: 0.85rem;
            box-shadow: 0 3px 0;
        }

        .order-item .order-actions .primary-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 0;
        }

        .order-item .order-actions .primary-btn:active {
            transform: translateY(2px);
            box-shadow: 0 1px 0;
        }
    </style>
</head>

<body class="bg-light-bg font-sans">

    <header>
        <div class="container flex justify-between items-center py-4">
            <div class="logo" id="logo-link">üåü ObshchagaSHOP</div>
            <!-- MOBILE ADAPTATION: –ó–º–µ–Ω—à—É—î–º–æ –≤—ñ–¥—Å—Ç—É–ø–∏ –º—ñ–∂ –µ–ª–µ–º–µ–Ω—Ç–∞–º–∏ –Ω–∞–≤—ñ–≥–∞—Ü—ñ—ó –Ω–∞ –º–æ–±—ñ–ª—å–Ω–∏—Ö -->
            <nav>
                <ul class="flex space-x-2 sm:space-x-4">
                    <!-- –ö–Ω–æ–ø–∫–∞ "–¢–æ–≤–∞—Ä–∏" –≤–∏–¥–∞–ª–µ–Ω–∞ -->
                    <li class="relative" id="cart-nav-item">
                        <a href="#cart" class="nav-link p-2 sm:p-3" data-page="cart" aria-label="–ö–æ—à–∏–∫">
                            <!-- –Ü–∫–æ–Ω–∫–∞ –∫–æ—à–∏–∫–∞ -->
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
                            </svg>
                        </a>
                        <span id="cart-count">0</span>
                    </li>
                    <!-- –ö–Ω–æ–ø–∫–∞ "–ê–¥–º—ñ–Ω" –≤–∏–¥–∞–ª–µ–Ω–∞ –∑ –Ω–∞–≤—ñ–≥–∞—Ü—ñ—ó -->
                </ul>
            </nav>
        </div>
    </header>

    <div class="container">
        <!-- –°–¢–û–†–Ü–ù–ö–ê –¢–û–í–ê–†–Ü–í -->
        <div id="products-page" class="page active">
            <!-- MOBILE ADAPTATION: –ó–º–µ–Ω—à—É—î–º–æ —Ä–æ–∑–º—ñ—Ä –∑–∞–≥–æ–ª–æ–≤–∫–∞ –Ω–∞ –º–æ–±—ñ–ª—å–Ω–∏—Ö -->
            <h1 class="text-2xl sm:text-3xl font-extrabold text-header-dark mb-6 sm:mb-8 border-b pb-2 sm:pb-3">–ö–∞—Ç–∞–ª–æ–≥
                —Ç–æ–≤–∞—Ä—ñ–≤</h1>

            <!-- –ü–æ–ª–µ –ø–æ—à—É–∫—É -->
            <div class="mb-6">
                <label for="search-input" class="sr-only">–ü–æ—à—É–∫ —Ç–æ–≤–∞—Ä—ñ–≤</label>
                <input type="text" id="search-input" placeholder="–ü–æ—à—É–∫ —Ç–æ–≤–∞—Ä—ñ–≤ –∑–∞ –Ω–∞–∑–≤–æ—é –∞–±–æ –æ–ø–∏—Å–æ–º..."
                    class="w-full p-3 border border-gray-300 rounded-lg focus:ring-accent-blue focus:border-accent-blue shadow-sm">
            </div>

            <!-- –§—ñ–ª—å—Ç—Ä–∏ —Ç–∞ —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è -->
            <!-- MOBILE ADAPTATION: –§—ñ–ª—å—Ç—Ä–∏ —Ç–µ–ø–µ—Ä –∑–∞–≤–∂–¥–∏ –≤ —Å—Ç–æ–≤–ø—á–∏–∫ –Ω–∞ –º–æ–±—ñ–ª—å–Ω–∏—Ö -->
            <div class="flex flex-col sm:flex-row justify-between items-center mb-6 gap-4">
                <div class="flex items-center gap-2 w-full sm:w-auto">
                    <label for="category-filter" class="font-medium text-gray-700 whitespace-nowrap">–ö–∞—Ç–µ–≥–æ—Ä—ñ—è:</label>
                    <select id="category-filter" class="border border-gray-300 rounded-lg p-2 w-full">
                        <option value="">–í—Å—ñ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó</option>
                        <!-- –ö–∞—Ç–µ–≥–æ—Ä—ñ—ó –±—É–¥—É—Ç—å –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ —Å—é–¥–∏ JS -->
                    </select>
                </div>

                <div class="flex items-center gap-2 w-full sm:w-auto">
                    <label for="sort-filter" class="font-medium text-gray-700 whitespace-nowrap">–°–æ—Ä—Ç—É–≤–∞—Ç–∏:</label>
                    <select id="sort-filter" class="border border-gray-300 rounded-lg p-2 w-full">
                        <option value="date_desc">–î–∞—Ç–∞ –¥–æ–¥–∞–≤–∞–Ω–Ω—è: –Ω–æ–≤—ñ</option>
                        <option value="date_asc">–î–∞—Ç–∞ –¥–æ–¥–∞–≤–∞–Ω–Ω—è: —Å—Ç–∞—Ä—ñ</option>
                        <option value="price_desc">–¶—ñ–Ω–∞: –≤—ñ–¥ –¥–æ—Ä–æ–∂—á–æ–≥–æ –¥–æ –¥–µ—à–µ–≤—à–æ–≥–æ</option>
                        <option value="price_asc">–¶—ñ–Ω–∞: –≤—ñ–¥ –¥–µ—à–µ–≤—à–æ–≥–æ –¥–æ –¥–æ—Ä–æ–∂—á–æ–≥–æ</option>
                    </select>
                </div>
            </div>

            <!-- MOBILE ADAPTATION: –°—ñ—Ç–∫–∞ —Ç–æ–≤–∞—Ä—ñ–≤ - 1 –∫–æ–ª–æ–Ω–∫–∞ –Ω–∞ –º–æ–±—ñ–ª—å–Ω–∏—Ö, 2 –Ω–∞ sm, 3 –Ω–∞ lg, 4 –Ω–∞ xl -->
            <div id="products-container"
                class="grid grid-cols-2 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 sm:gap-8">
                <!-- –¢–æ–≤–∞—Ä–∏ –±—É–¥—É—Ç—å –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ —Å—é–¥–∏ -->
            </div>
            <div id="loading" class="text-center text-xl text-gray-500 mt-12">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ç–æ–≤–∞—Ä—ñ–≤...</div>
            <div id="error-message" class="text-center text-xl text-red-500 mt-12 hidden p-4 bg-red-100 rounded-xl">
            </div>
        </div>

        <!-- –°–¢–û–†–Ü–ù–ö–ê –ö–û–®–ò–ö–ê -->
        <div id="cart-page" class="page">
            <!-- MOBILE ADAPTATION: –ó–º–µ–Ω—à—É—î–º–æ —Ä–æ–∑–º—ñ—Ä –∑–∞–≥–æ–ª–æ–≤–∫–∞ –Ω–∞ –º–æ–±—ñ–ª—å–Ω–∏—Ö -->
            <h1 class="text-2xl sm:text-3xl font-extrabold text-header-dark mb-6 sm:mb-8 border-b pb-2 sm:pb-3">–í–∞—à
                –∫–æ—à–∏–∫</h1>

            <div id="cart-items" class="space-y-4">
                <!-- –ï–ª–µ–º–µ–Ω—Ç–∏ –∫–æ—à–∏–∫–∞ -->
            </div>

            <!-- MOBILE ADAPTATION: –°—É–º–∞ –∫–æ—à–∏–∫–∞ —Ç–∞ –∫–Ω–æ–ø–∫–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–Ω—è - –∞–¥–∞–ø—Ç–∏–≤–Ω—ñ -->
            <div
                class="flex flex-col sm:flex-row justify-end items-end sm:items-center mt-8 pt-4 border-t border-gray-200">
                <div
                    class="text-xl sm:text-2xl font-bold text-header-dark mr-0 sm:mr-6 mb-4 sm:mb-0 w-full sm:w-auto text-right">
                    –†–∞–∑–æ–º: <span id="cart-total" class="text-success-green">0.00</span> –≥—Ä–Ω
                </div>
            </div>

            <!-- –§–æ—Ä–º–∞ –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ –ö–ª—ñ—î–Ω—Ç–∞ -->
            <div class="mt-8 p-4 sm:p-6 bg-light-bg rounded-xl shadow-inner border border-border-light">
                <!-- MOBILE ADAPTATION: –ó–º–µ–Ω—à—É—î–º–æ —Ä–æ–∑–º—ñ—Ä –∑–∞–≥–æ–ª–æ–≤–∫–∞ —Ñ–æ—Ä–º–∏ –Ω–∞ –º–æ–±—ñ–ª—å–Ω–∏—Ö -->
                <h2 class="text-xl sm:text-2xl font-bold text-header-dark mb-4 sm:mb-6">–î–∞–Ω—ñ –¥–ª—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
                </h2>
                <form id="customer-info-form" class="space-y-4">
                    <div>
                        <label for="customer-name" class="block mb-1 font-medium text-gray-700">–í–∞—à–µ —ñ–º'—è</label>
                        <input type="text" id="customer-name"
                            class="w-full p-3 border border-gray-300 rounded-lg focus:ring-accent-blue focus:border-accent-blue"
                            placeholder="–Ü–≤–∞–Ω –Ü–≤–∞–Ω–æ–≤" required>
                    </div>
                    <div>
                        <label for="customer-telegram" class="block mb-1 font-medium text-gray-700">–í–∞—à –Ω—ñ–∫ —É Telegram (–±–µ–∑ @) <span class="text-red-500">*</span></label>
                        <input type="text" id="customer-telegram"
                            class="w-full p-3 border border-gray-300 rounded-lg focus:ring-accent-blue focus:border-accent-blue"
                            placeholder="username" required>
                        <p class="text-sm text-gray-500 mt-1">–û–±–æ–≤'—è–∑–∫–æ–≤–æ –∑–∞—Ä–µ—î—Å—Ç—Ä—É–π—Ç–µ—Å—å —É –Ω–∞—à–æ–º—É Telegram –±–æ—Ç—ñ (<a
                                href="https://t.me/obschaga10shop_bot" target="_blank"
                                class="text-accent-blue hover:underline">@obschaga10shop_bot</a>) –∫–æ–º–∞–Ω–¥–æ—é /start, —â–æ–±
                            –æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è –ø—Ä–æ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è.</p>
                    </div>
                    <div>
                        <label for="customer-phone" class="block mb-1 font-medium text-gray-700">–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É</label>
                        <input type="tel" id="customer-phone"
                            class="w-full p-3 border border-gray-300 rounded-lg focus:ring-accent-blue focus:border-accent-blue"
                            placeholder="+380XXXXXXXXX" required>
                    </div>
                    <div>
                        <label for="customer-address" class="block mb-1 font-medium text-gray-700">–ö—ñ–º–Ω–∞—Ç–∞ –¥–æ—Å—Ç–∞–≤–∫–∏</label>
                        <input type="text" id="customer-address"
                            class="w-full p-3 border border-gray-300 rounded-lg focus:ring-accent-blue focus:border-accent-blue"
                            placeholder="666">
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" id="needs-delivery"
                            class="h-5 w-5 text-accent-blue rounded focus:ring-accent-blue">
                        <label for="needs-delivery" class="ml-2 block text-gray-900">–ü–æ—Ç—Ä—ñ–±–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∞ (+50 –≥—Ä–Ω)</label>
                    </div>
                    <button type="submit" id="checkout-btn"
                        class="primary-btn w-full text-base py-3 px-8 text-lg w-full transition duration-300"
                        disabled>
                        –û—Ñ–æ—Ä–º–∏—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
                    </button>
                </form>
            </div>
        </div>

        <!-- –°–¢–û–†–Ü–ù–ö–ê –ê–î–ú–Ü–ù-–ü–ê–ù–ï–õ–Ü -->
        <div id="admin-page" class="page">
            <!-- MOBILE ADAPTATION: –ó–º–µ–Ω—à—É—î–º–æ —Ä–æ–∑–º—ñ—Ä –∑–∞–≥–æ–ª–æ–≤–∫–∞ –Ω–∞ –º–æ–±—ñ–ª—å–Ω–∏—Ö -->
            <h1 class="text-2xl sm:text-3xl font-extrabold text-header-dark mb-6 sm:mb-8 border-b pb-2 sm:pb-3">
                –ê–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å</h1>

            <div id="admin-login-area">
                <!-- MOBILE ADAPTATION: –ó–º–µ–Ω—à—É—î–º–æ padding —Ç–∞ —Ä–æ–∑–º—ñ—Ä –∑–∞–≥–æ–ª–æ–≤–∫–∞ —Ñ–æ—Ä–º–∏ –Ω–∞ –º–æ–±—ñ–ª—å–Ω–∏—Ö -->
                <form id="admin-login-form"
                    class="space-y-6 p-6 sm:p-8 border border-border-light rounded-xl max-w-sm mx-auto shadow-lg bg-white">
                    <h2 class="text-xl sm:text-2xl font-bold text-center text-header-dark">–í—Ö—ñ–¥ –ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h2>
                    <div>
                        <label for="admin-username" class="block mb-1 font-medium text-gray-700">–Ü–º'—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞</label>
                        <input type="text" id="admin-username"
                            class="w-full p-3 border border-gray-300 rounded-lg focus:ring-accent-blue focus:border-accent-blue"
                            required>
                    </div>
                    <div>
                        <label for="admin-password" class="block mb-1 font-medium text-gray-700">–ü–∞—Ä–æ–ª—å</label>
                        <input type="password" id="admin-password"
                            class="w-full p-3 border border-gray-300 rounded-lg focus:ring-accent-blue focus:border-accent-blue"
                            required>
                    </div>
                    <button type="submit" class="primary-btn w-full">–£–≤—ñ–π—Ç–∏</button>
                    <p id="login-error" class="text-red-500 text-sm hidden text-center"></p>
                </form>
            </div>

            <div id="admin-content" class="hidden">
                <!-- –ù–∞–≤—ñ–≥–∞—Ü—ñ—è –∞–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—ñ -->
                <div class="flex flex-wrap gap-2 mb-6 border-b pb-4">
                    <button type="button" data-admin-page="products-management" class="admin-nav-btn primary-btn bg-accent-blue hover:bg-blue-600 shadow-blue-700">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M7 3a1 1 0 00-1 1v1a1 1 0 001 1h2a1 1 0 001-1V4a1 1 0 00-1-1H7zM7 7a1 1 0 00-1 1v1a1 1 0 001 1h2a1 1 0 001-1V8a1 1 0 00-1-1H7zM7 11a1 1 0 00-1 1v1a1 1 0 001 1h2a1 1 0 001-1v-1a1 1 0 00-1-1H7zM7 15a1 1 0 00-1 1v1a1 1 0 001 1h2a1 1 0 001-1v-1a1 1 0 00-1-1H7zM11 3a1 1 0 00-1 1v1a1 1 0 001 1h2a1 1 0 001-1V4a1 1 0 00-1-1h-2zM11 7a1 1 0 00-1 1v1a1 1 0 001 1h2a1 1 0 001-1V8a1 1 0 00-1-1h-2zM11 11a1 1 0 00-1 1v1a1 1 0 001 1h2a1 1 0 001-1v-1a1 1 0 00-1-1h-2zM11 15a1 1 0 00-1 1v1a1 1 0 001 1h2a1 1 0 001-1v-1a1 1 0 00-1-1h-2z" />
                        </svg>
                        –¢–æ–≤–∞—Ä–∏
                    </button>
                    <button type="button" data-admin-page="orders-management" class="admin-nav-btn primary-btn bg-indigo-600 hover:bg-indigo-700 shadow-indigo-800">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M5 4a3 3 0 00-3 3v6a3 3 0 003 3h10a3 3 0 003-3V7a3 3 0 00-3-3H5zm-1 9v-1h12v1a1 1 0 01-1 1H5a1 1 0 01-1-1zm1-8a1 1 0 00-1 1v1h12V7a1 1 0 00-1-1H5z" clip-rule="evenodd" />
                        </svg>
                        –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è
                    </button>
                    <button type="button" data-admin-page="users-management" class="admin-nav-btn primary-btn bg-green-600 hover:bg-green-700 shadow-green-800">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" />
                        </svg>
                        –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ
                    </button>
                    <button type="button" data-admin-page="notifications-management" class="admin-nav-btn primary-btn bg-purple-600 hover:bg-purple-700 shadow-purple-800">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M10 2a6 6 0 00-6 6v3.586l-.707.707A1 1 0 012.707 13H17.293a1 1 0 01.707-1.707L16 11.586V8a6 6 0 00-6-6zM10 16a2 2 0 01-2-2h4a2 2 0 01-2 2z" />
                        </svg>
                        –°–ø–æ–≤—ñ—â–µ–Ω–Ω—è
                    </button>
                </div>

                <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Ç–æ–≤–∞—Ä–∞–º–∏ -->
                <div id="products-management-section" class="admin-section">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 sm:gap-8">
                        <!-- –§–û–†–ú–ê –î–û–î–ê–í–ê–ù–ù–Ø –¢–û–í–ê–†–£ -->
                        <div>
                            <h2 class="text-xl sm:text-2xl font-bold text-accent-blue mb-4">–î–æ–¥–∞—Ç–∏ –Ω–æ–≤–∏–π —Ç–æ–≤–∞—Ä</h2>
                            <form id="add-product-form"
                                class="space-y-4 p-4 sm:p-6 bg-light-bg rounded-xl shadow-inner border border-border-light"
                                enctype="multipart/form-data">
                                <input type="text" id="product-name" placeholder="–ù–∞–∑–≤–∞ —Ç–æ–≤–∞—Ä—É"
                                    class="w-full p-3 border rounded-lg focus:ring-accent-blue focus:border-accent-blue"
                                    required>
                                <textarea id="product-description" placeholder="–û–ø–∏—Å —Ç–æ–≤–∞—Ä—É (–Ω–µ–æ–±–æ–≤'—è–∑–∫–æ–≤–æ)"
                                    class="w-full p-3 border rounded-lg focus:ring-accent-blue focus:border-accent-blue"
                                    rows="3"></textarea>
                                <input type="number" id="product-price" placeholder="–¶—ñ–Ω–∞ (–≥—Ä–Ω)" step="0.01" min="0.01"
                                    class="w-full p-3 border rounded-lg focus:ring-accent-blue focus:border-accent-blue"
                                    required>

                                <!-- –ü–æ–ª—è –¥–ª—è –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è -->
                                <div>
                                    <label for="product-image-file" class="block mb-1 font-medium text-gray-700">–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è (—Ñ–∞–π–ª)</label>
                                    <input type="file" id="product-image-file" accept="image/*"
                                        class="w-full p-3 border rounded-lg focus:ring-accent-blue focus:border-accent-blue">
                                    <p class="text-sm text-gray-500 mt-1">–ê–±–æ</p>
                                </div>
                                <div>
                                    <label for="product-image-url" class="block mb-1 font-medium text-gray-700">–í—Å—Ç–∞–≤–∏—Ç–∏ URL –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è</label>
                                    <input type="url" id="product-image-url" placeholder="https://example.com/image.jpg"
                                        class="w-full p-3 border rounded-lg focus:ring-accent-blue focus:border-accent-blue">
                                    <p class="text-sm text-gray-500 mt-1">–Ø–∫—â–æ –∑–∞–ø–æ–≤–Ω–µ–Ω—ñ –æ–±–∏–¥–≤–∞ –ø–æ–ª—è, –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç –±—É–¥–µ —É
                                        –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ–≥–æ —Ñ–∞–π–ª—É.</p>
                                </div>

                                <input type="number" id="product-stock" placeholder="–ö—ñ–ª—å–∫—ñ—Å—Ç—å –≤ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ" min="0" value="1"
                                    class="w-full p-3 border rounded-lg focus:ring-accent-blue focus:border-accent-blue"
                                    required>

                                <!-- –ü–æ–ª—è –¥–ª—è –∑–Ω–∏–∂–æ–∫ -->
                                <div
                                    class="flex flex-col sm:flex-row items-start sm:items-center space-y-2 sm:space-y-0 sm:space-x-4">
                                    <label for="product-discount" class="font-medium text-gray-700">–ó–Ω–∏–∂–∫–∞ (%)</label>
                                    <input type="number" id="product-discount" value="0" min="0" max="100"
                                        class="w-full sm:w-24 p-3 border rounded-lg focus:ring-accent-blue focus:border-accent-blue">
                                    <div class="flex items-center">
                                        <input type="checkbox" id="product-on-sale"
                                            class="h-5 w-5 text-accent-blue rounded focus:ring-accent-blue">
                                        <label for="product-on-sale" class="ml-2 text-gray-900">–ê–∫—Ü—ñ—è</label>
                                    </div>
                                </div>

                                <!-- –í–∏–±—ñ—Ä –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó –¥–ª—è —Ç–æ–≤–∞—Ä—É -->
                                <div>
                                    <label for="product-category-select" class="block mb-1 font-medium text-gray-700">–ö–∞—Ç–µ–≥–æ—Ä—ñ—è —Ç–æ–≤–∞—Ä—É</label>
                                    <select id="product-category-select" class="w-full p-3 border rounded-lg focus:ring-accent-blue focus:border-accent-blue">
                                        <option value="">–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó</option>
                                        <!-- –ö–∞—Ç–µ–≥–æ—Ä—ñ—ó –±—É–¥—É—Ç—å –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ —Å—é–¥–∏ JS -->
                                    </select>
                                </div>

                                <button type="submit"
                                    class="primary-btn bg-success-green hover:bg-green-600 shadow-green-700 flex items-center justify-center w-full">
                                    <div id="add-product-spinner"></div> –î–æ–¥–∞—Ç–∏ –¥–æ MySQL
                                </button>
                                <p id="add-product-error" class="text-red-500 text-sm hidden"></p>
                            </form>
                        </div>

                        <!-- –ö–µ—Ä—É–≤–∞–Ω–Ω—è –∫–∞—Ç–µ–≥–æ—Ä—ñ—è–º–∏ -->
                        <div>
                            <h2 class="text-xl sm:text-2xl font-bold text-accent-blue mb-4">–ö–µ—Ä—É–≤–∞–Ω–Ω—è –∫–∞—Ç–µ–≥–æ—Ä—ñ—è–º–∏</h2>
                            <form id="add-category-form"
                                class="space-y-3 p-4 bg-light-bg rounded-xl shadow-inner border border-border-light mb-6">
                                <input type="text" id="category-name-input" placeholder="–ù–∞–∑–≤–∞ –Ω–æ–≤–æ—ó –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó"
                                    class="w-full p-3 border rounded-lg focus:ring-accent-blue focus:border-accent-blue"
                                    required>
                                <button type="submit" class="primary-btn w-full bg-purple-600 hover:bg-purple-700 shadow-purple-800">
                                    –î–æ–¥–∞—Ç–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ—é
                                </button>
                                <p id="add-category-error" class="text-red-500 text-sm hidden"></p>
                            </form>
                            <div id="admin-categories-list"
                                class="space-y-2 p-4 bg-white rounded-xl h-40 sm:h-48 overflow-y-auto border border-border-light shadow-md">
                                <!-- –°–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä—ñ–π –¥–ª—è –∞–¥–º—ñ–Ω–∞ -->
                                <p class="text-gray-500">–ö–∞—Ç–µ–≥–æ—Ä—ñ—ó –±—É–¥—É—Ç—å –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ —Ç—É—Ç.</p>
                            </div>
                        </div>

                        <!-- –ù–û–í–ò–ô –ë–õ–û–ö: –Ü–ú–ü–û–†–¢ –¢–û–í–ê–†–Ü–í –ó CSV -->
                        <div>
                            <h2 class="text-xl sm:text-2xl font-bold text-accent-blue mb-4">–Ü–º–ø–æ—Ä—Ç —Ç–æ–≤–∞—Ä—ñ–≤ –∑ CSV</h2>
                            <div class="p-4 sm:p-6 bg-light-bg rounded-xl shadow-inner border border-border-light">
                                <p class="text-gray-700 mb-4">–ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ CSV-—Ñ–∞–π–ª –¥–ª—è –º–∞—Å–æ–≤–æ–≥–æ –¥–æ–¥–∞–≤–∞–Ω–Ω—è/–æ–Ω–æ–≤–ª–µ–Ω–Ω—è
                                    —Ç–æ–≤–∞—Ä—ñ–≤.
                                </p>
                                <p class="text-sm text-gray-500 mb-4">
                                    –§–æ—Ä–º–∞—Ç CSV: `–ù–∞–∑–≤–∞ –ø—Ä–æ–¥—É–∫—Ç—É,—Ü—ñ–Ω–∞ –∑–∞ —à—Ç—É–∫—É,–∫—ñ–ª—å–∫—ñ—Å—Ç—å,–∞–∫—Ü—ñ—è —è–∫—à–æ —î (1/0),–≤—ñ–¥—Å–æ—Ç–æ–∫
                                    –∑–Ω–∏–∂–∫–∏,–æ–ø–∏—Å,URL –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è`.
                                    <br>
                                    * `–∞–∫—Ü—ñ—è —è–∫—à–æ —î (1/0)`: `1` –¥–ª—è –∞–∫—Ü—ñ—ó, `0` —è–∫—â–æ –Ω–µ–º–∞—î.
                                    <br>
                                    * `–≤—ñ–¥—Å–æ—Ç–æ–∫ –∑–Ω–∏–∂–∫–∏`: —á–∏—Å–ª–æ –≤—ñ–¥ `0` –¥–æ `100`.
                                    <br>
                                    * `URL –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è`: –ø—Ä—è–º–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è (–Ω–µ–æ–±–æ–≤'—è–∑–∫–æ–≤–æ).
                                    <br>
                                    * –Ø–∫—â–æ —Ç–æ–≤–∞—Ä –∑ —Ç–∞–∫–æ—é –Ω–∞–∑–≤–æ—é –≤–∂–µ —ñ—Å–Ω—É—î, –≤—ñ–Ω –±—É–¥–µ –æ–Ω–æ–≤–ª–µ–Ω–∏–π.
                                </p>
                                <form id="import-csv-form" class="space-y-4" enctype="multipart/form-data">
                                    <div>
                                        <label for="csv-file-input" class="block mb-1 font-medium text-gray-700">–í–∏–±–µ—Ä—ñ—Ç—å CSV-—Ñ–∞–π–ª</label>
                                        <input type="file" id="csv-file-input" accept=".csv"
                                            class="w-full p-3 border rounded-lg focus:ring-accent-blue focus:border-accent-blue"
                                            required>
                                    </div>
                                    <button type="submit" id="import-csv-btn"
                                        class="primary-btn bg-purple-600 hover:bg-purple-700 shadow-purple-800 flex items-center justify-center w-full">
                                        <div id="import-csv-spinner"></div> –Ü–º–ø–æ—Ä—Ç—É–≤–∞—Ç–∏ CSV
                                    </button>
                                    <p id="import-csv-error" class="text-red-500 text-sm hidden"></p>
                                    <p id="import-csv-success" class="text-success-green text-sm hidden"></p>
                                </form>
                                <button type="button" id="export-csv-sample-btn" class="primary-btn bg-gray-600 hover:bg-gray-700 shadow-gray-800 flex items-center justify-center w-full mt-4">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
                                    </svg>
                                    –ï–∫—Å–ø–æ—Ä—Ç—É–≤–∞—Ç–∏ –∑—Ä–∞–∑–æ–∫ CSV
                                </button>
                            </div>
                        </div>
                        <!-- –ö–Ü–ù–ï–¶–¨ –ù–û–í–û–ì–û –ë–õ–û–ö–£ -->

                        <!-- –°–ü–ò–°–û–ö –ü–û–¢–û–ß–ù–ò–• –¢–û–í–ê–†–Ü–í -->
                        <div class="lg:col-span-2">
                            <h2 class="text-xl sm:text-2xl font-bold text-accent-blue mb-4">–ü–æ—Ç–æ—á–Ω—ñ —Ç–æ–≤–∞—Ä–∏ (–ö–µ—Ä—É–≤–∞–Ω–Ω—è)
                            </h2>
                            <div id="admin-products-list"
                                class="space-y-3 p-4 bg-white rounded-xl h-80 sm:h-96 overflow-y-auto border border-border-light shadow-md">
                                <!-- –°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä—ñ–≤ –¥–ª—è –∞–¥–º—ñ–Ω–∞ -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è–º–∏ -->
                <div id="orders-management-section" class="admin-section hidden">
                    <h2 class="text-xl sm:text-2xl font-bold text-accent-blue mb-4">–ö–µ—Ä—É–≤–∞–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è–º–∏</h2>
                    <div class="mb-4 flex flex-wrap gap-4 items-center">
                        <label for="order-status-filter" class="font-medium text-gray-700">–§—ñ–ª—å—Ç—Ä –∑–∞ —Å—Ç–∞—Ç—É—Å–æ–º:</label>
                        <select id="order-status-filter" class="border border-gray-300 rounded-lg p-2">
                            <option value="">–í—Å—ñ —Å—Ç–∞—Ç—É—Å–∏</option>
                            <option value="New">–ù–æ–≤—ñ</option>
                            <option value="Confirmed">–ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω—ñ</option>
                            <option value="Cancelled">–°–∫–∞—Å–æ–≤–∞–Ω—ñ</option>
                        </select>
                        <button type="button" id="refresh-orders-btn" class="primary-btn bg-indigo-600 hover:bg-indigo-700 shadow-indigo-800">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.008a.5.5 0 01.416.223l.47 1.024a.5.5 0 01-.416.777H4a.5.5 0 01-.416-.777l.47-1.024a.5.5 0 01.416-.223zM16 17a1 1 0 01-1-1v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 111.885-.666A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 01-1 1z" clip-rule="evenodd" />
                            </svg>
                            –û–Ω–æ–≤–∏—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
                        </button>
                    </div>
                    <div id="admin-orders-list"
                        class="space-y-3 p-4 bg-white rounded-xl h-96 overflow-y-auto border border-border-light shadow-md">
                        <p class="text-gray-500">–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è –±—É–¥—É—Ç—å –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ —Ç—É—Ç.</p>
                    </div>
                </div>

                <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º–∏ -->
                <div id="users-management-section" class="admin-section hidden">
                    <h2 class="text-xl sm:text-2xl font-bold text-accent-blue mb-4">–ó–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ Telegram
                    </h2>
                    <div id="admin-customers-list"
                        class="space-y-3 p-4 bg-white rounded-xl h-80 sm:h-96 overflow-y-auto border border-border-light shadow-md">
                        <p class="text-gray-500">–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –±—É–¥—É—Ç—å –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ —Ç—É—Ç.</p>
                    </div>
                    <button type="button" id="refresh-customers-btn" class="primary-btn bg-indigo-600 hover:bg-indigo-700 shadow-indigo-800 flex items-center justify-center w-full mt-4">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.008a.5.5 0 01.416.223l.47 1.024a.5.5 0 01-.416.777H4a.5.5 0 01-.416-.777l.47-1.024a.5.5 0 01.416-.223zM16 17a1 1 0 01-1-1v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 111.885-.666A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 01-1 1z" clip-rule="evenodd" />
                        </svg>
                        –û–Ω–æ–≤–∏—Ç–∏ —Å–ø–∏—Å–æ–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
                    </button>
                </div>

                <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è–º–∏ -->
                <div id="notifications-management-section" class="admin-section hidden">
                    <h2 class="text-xl sm:text-2xl font-bold text-accent-blue mb-4">–í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –∑–∞–≥–∞–ª—å–Ω–µ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è</h2>
                    <div class="p-4 sm:p-6 bg-light-bg rounded-xl shadow-inner border border-border-light">
                        <p class="text-gray-700 mb-4">–ù–∞–¥—ñ—à–ª—ñ—Ç—å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤—Å—ñ–º –ø—ñ–¥–ø–∏—Å–Ω–∏–∫–∞–º Telegram.</p>
                        <button type="button" id="open-general-notify-modal-btn" class="general-notify-btn w-full">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M15 17v2m-2-2H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            –°—Ç–≤–æ—Ä–∏—Ç–∏ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è
                        </button>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- –ö–û–†–ò–°–¢–£–í–ê–¶–¨–ö–ï –î–Ü–ê–õ–û–ì–û–í–ï –í–Ü–ö–ù–û (–ó–∞–º—ñ–Ω–∞ alert/confirm) -->
    <div id="dialog-box" class="dialog-overlay">
        <div class="dialog-content">
            <p id="dialog-message" class="text-xl font-semibold text-gray-800 mb-8"></p>
            <div class="dialog-actions flex justify-center space-x-4">
                <button id="dialog-alert-btn"
                    class="bg-accent-blue text-white px-6 py-2 rounded-lg hover:bg-blue-600 font-medium transition primary-btn">–û–ö</button>
                <button id="dialog-confirm-btn"
                    class="bg-success-green text-white px-6 py-2 rounded-lg hover:bg-green-600 font-medium transition hidden primary-btn">–ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏</button>
                <button id="dialog-cancel-btn"
                    class="bg-gray-400 text-white px-6 py-2 rounded-lg hover:bg-gray-500 font-medium transition hidden primary-btn shadow-gray-600">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
            </div>
        </div>
    </div>

    <!-- –ú–û–î–ê–õ–¨–ù–ï –í–Ü–ö–ù–û –†–ï–î–ê–ì–£–í–ê–ù–ù–Ø –¢–û–í–ê–†–£ -->
    <div id="edit-product-modal" class="dialog-overlay">
        <!-- MOBILE ADAPTATION: –ó–º–µ–Ω—à—É—î–º–æ max-width —Ç–∞ padding –Ω–∞ –º–æ–±—ñ–ª—å–Ω–∏—Ö -->
        <div class="dialog-content !max-w-md sm:!max-w-2xl !p-4 sm:!p-6">
            <!-- MOBILE ADAPTATION: –ó–º–µ–Ω—à—É—î–º–æ —Ä–æ–∑–º—ñ—Ä –∑–∞–≥–æ–ª–æ–≤–∫–∞ –Ω–∞ –º–æ–±—ñ–ª—å–Ω–∏—Ö -->
            <h2 class="text-xl sm:text-2xl font-bold text-header-dark mb-4 sm:mb-6 text-left">–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ —Ç–æ–≤–∞—Ä</h2>
            <form id="edit-product-form" class="space-y-4" enctype="multipart/form-data">
                <input type="hidden" id="edit-product-id">
                <input type="hidden" id="edit-image-url-changed" value="false">
                <div>
                    <label for="edit-product-name" class="block mb-1 font-medium text-gray-700">–ù–∞–∑–≤–∞ —Ç–æ–≤–∞—Ä—É</label>
                    <input type="text" id="edit-product-name"
                        class="w-full p-3 border rounded-lg focus:ring-accent-blue focus:border-accent-blue"
                        required>
                </div>
                <div>
                    <label for="edit-product-description" class="block mb-1 font-medium text-gray-700">–û–ø–∏—Å —Ç–æ–≤–∞—Ä—É</label>
                    <textarea id="edit-product-description"
                        class="w-full p-3 border rounded-lg focus:ring-accent-blue focus:border-accent-blue"
                        rows="4"></textarea>
                </div>
                <!-- MOBILE ADAPTATION: –¶—ñ–Ω–∞ —Ç–∞ –Ω–∞—è–≤–Ω—ñ—Å—Ç—å - –≤ —Å—Ç–æ–≤–ø—á–∏–∫ –Ω–∞ –º–æ–±—ñ–ª—å–Ω–∏—Ö -->
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div>
                        <label for="edit-product-price" class="block mb-1 font-medium text-gray-700">–¶—ñ–Ω–∞ (–≥—Ä–Ω)</label>
                        <input type="number" id="edit-product-price" step="0.01" min="0.01"
                            class="w-full p-3 border rounded-lg focus:ring-accent-blue focus:border-accent-blue"
                            required>
                    </div>
                    <div>
                        <label for="edit-product-stock" class="block mb-1 font-medium text-gray-700">–ö—ñ–ª—å–∫—ñ—Å—Ç—å –≤ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ</label>
                        <input type="number" id="edit-product-stock" min="0"
                            class="w-full p-3 border rounded-lg focus:ring-accent-blue focus:border-accent-blue"
                            required>
                    </div>
                </div>

                <!-- –ü–æ–ª—è –¥–ª—è –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è -->
                <div>
                    <label class="block mb-1 font-medium text-gray-700">–ü–æ—Ç–æ—á–Ω–µ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è</label>
                    <img id="edit-current-image-preview" src="" alt="–ü–æ—Ç–æ—á–Ω–µ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è" class="w-24 h-24 object-cover rounded-lg mb-2 border border-gray-200" loading="lazy">
                    <label for="edit-product-image-file" class="block mb-1 font-medium text-gray-700">–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –Ω–æ–≤–µ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è (—Ñ–∞–π–ª)</label>
                    <input type="file" id="edit-product-image-file" accept="image/*"
                        class="w-full p-3 border rounded-lg focus:ring-accent-blue focus:border-accent-blue">
                    <p class="text-sm text-gray-500 mt-1">–ê–±–æ</p>
                </div>
                <div>
                    <label for="edit-product-image-url" class="block mb-1 font-medium text-gray-700">–í—Å—Ç–∞–≤–∏—Ç–∏ URL –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è</label>
                    <input type="url" id="edit-product-image-url" placeholder="https://example.com/image.jpg"
                        class="w-full p-3 border rounded-lg focus:ring-accent-blue focus:border-accent-blue">
                    <p class="text-sm text-gray-500 mt-1">–Ø–∫—â–æ –∑–∞–ø–æ–≤–Ω–µ–Ω—ñ –æ–±–∏–¥–≤–∞ –ø–æ–ª—è, –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç –±—É–¥–µ —É –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ–≥–æ
                        —Ñ–∞–π–ª—É.</p>
                </div>

                <!-- –ü–æ–ª—è –¥–ª—è –∑–Ω–∏–∂–æ–∫ -->
                <!-- MOBILE ADAPTATION: –ó–Ω–∏–∂–∫–∏ - –∞–¥–∞–ø—Ç–∏–≤–Ω—ñ -->
                <div class="flex flex-col sm:flex-row items-start sm:items-center space-y-2 sm:space-y-0 sm:space-x-4">
                    <label for="edit-product-discount" class="font-medium text-gray-700">–ó–Ω–∏–∂–∫–∞ (%)</label>
                    <input type="number" id="edit-product-discount" value="0" min="0" max="100"
                        class="w-full sm:w-24 p-3 border rounded-lg focus:ring-accent-blue focus:border-accent-blue">
                    <div class="flex items-center">
                        <input type="checkbox" id="edit-product-on-sale"
                            class="h-5 w-5 text-accent-blue rounded focus:ring-accent-blue">
                        <label for="edit-product-on-sale" class="ml-2 text-gray-900">–ê–∫—Ü—ñ—è</label>
                    </div>
                </div>

                <!-- –í–∏–±—ñ—Ä –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó –¥–ª—è —Ç–æ–≤–∞—Ä—É -->
                <div>
                    <label for="edit-product-category-select" class="block mb-1 font-medium text-gray-700">–ö–∞—Ç–µ–≥–æ—Ä—ñ—è —Ç–æ–≤–∞—Ä—É</label>
                    <select id="edit-product-category-select" class="w-full p-3 border rounded-lg focus:ring-accent-blue focus:border-accent-blue">
                        <option value="">–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó</option>
                        <!-- –ö–∞—Ç–µ–≥–æ—Ä—ñ—ó –±—É–¥—É—Ç—å –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ —Å—é–¥–∏ JS -->
                    </select>
                </div>

                <!-- MOBILE ADAPTATION: –ö–Ω–æ–ø–∫–∏ - –∞–¥–∞–ø—Ç–∏–≤–Ω—ñ -->
                <div class="flex flex-col sm:flex-row justify-end space-y-2 sm:space-y-0 sm:space-x-4 mt-6">
                    <button type="button" id="cancel-edit-btn"
                        class="primary-btn bg-gray-400 hover:bg-gray-500 shadow-gray-600 w-full sm:w-auto">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
                    <button type="submit" id="save-edit-btn"
                        class="primary-btn bg-accent-blue hover:bg-blue-600 shadow-blue-700 flex items-center justify-center w-full sm:w-auto">
                        <div id="edit-product-spinner"></div> –ó–±–µ—Ä–µ–≥—Ç–∏ –∑–º—ñ–Ω–∏
                    </button>
                </div>
                <p id="edit-product-error" class="text-red-500 text-sm hidden text-center"></p>
            </form>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó -->
    <div id="edit-category-modal" class="dialog-overlay">
        <!-- MOBILE ADAPTATION: –ó–º–µ–Ω—à—É—î–º–æ max-width —Ç–∞ padding –Ω–∞ –º–æ–±—ñ–ª—å–Ω–∏—Ö -->
        <div class="dialog-content !max-w-xs sm:!max-w-md w-full">
            <!-- MOBILE ADAPTATION: –ó–º–µ–Ω—à—É—î–º–æ —Ä–æ–∑–º—ñ—Ä –∑–∞–≥–æ–ª–æ–≤–∫–∞ –Ω–∞ –º–æ–±—ñ–ª—å–Ω–∏—Ö -->
            <h2 class="text-xl sm:text-2xl font-bold mb-4">–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ—é</h2>
            <form id="edit-category-form" class="space-y-4">
                <input type="hidden" id="edit-category-id">
                <input type="text" id="edit-category-name" placeholder="–ù–∞–∑–≤–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó"
                    class="w-full p-3 border border-gray-300 rounded-lg focus:ring-accent-blue focus:border-accent-blue" required>
                <!-- MOBILE ADAPTATION: –ö–Ω–æ–ø–∫–∏ - –∞–¥–∞–ø—Ç–∏–≤–Ω—ñ -->
                <div class="flex flex-col sm:flex-row justify-end space-y-2 sm:space-y-0 sm:space-x-4 mt-6">
                    <button type="button" id="cancel-edit-category-btn"
                        class="primary-btn bg-gray-400 hover:bg-gray-500 shadow-gray-600 w-full sm:w-auto">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
                    <button type="submit" id="save-edit-category-btn"
                        class="primary-btn bg-accent-blue hover:bg-blue-600 shadow-blue-700 w-full sm:w-auto">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
                </div>
                <p id="edit-category-error" class="text-red-500 text-sm hidden text-center"></p>
            </form>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –≤–ª–∞—Å–Ω–æ–≥–æ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è (—Ç–µ–ø–µ—Ä –¥–ª—è –∑–∞–≥–∞–ª—å–Ω–∏—Ö –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å) -->
    <div id="custom-notify-modal" class="dialog-overlay">
        <!-- MOBILE ADAPTATION: –ó–º–µ–Ω—à—É—î–º–æ max-width —Ç–∞ padding –Ω–∞ –º–æ–±—ñ–ª—å–Ω–∏—Ö -->
        <div class="dialog-content !max-w-md sm:!max-w-lg w-full">
            <!-- MOBILE ADAPTATION: –ó–º–µ–Ω—à—É—î–º–æ —Ä–æ–∑–º—ñ—Ä –∑–∞–≥–æ–ª–æ–≤–∫–∞ –Ω–∞ –º–æ–±—ñ–ª—å–Ω–∏—Ö -->
            <h2 class="text-xl sm:text-2xl font-bold mb-4">–°—Ç–≤–æ—Ä–∏—Ç–∏ –∑–∞–≥–∞–ª—å–Ω–µ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è</h2>
            <form id="custom-notify-form" class="space-y-4">
                <textarea id="notify-message-text" rows="5" placeholder="–í–≤–µ–¥—ñ—Ç—å —Ç–µ–∫—Å—Ç –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è..."
                    class="w-full p-3 border border-gray-300 rounded-lg focus:ring-accent-blue focus:border-accent-blue" required></textarea>
                <div>
                    <label for="notify-image-file" class="block mb-1 font-medium text-gray-700">–î–æ–¥–∞—Ç–∏ —Ñ–æ—Ç–æ (–Ω–µ–æ–±–æ–≤‚Äô—è–∑–∫–æ–≤–æ)</label>
                    <input type="file" id="notify-image-file" accept="image/*"
                        class="w-full p-2 border border-gray-300 rounded-lg focus:ring-accent-blue focus:border-accent-blue">
                </div>
                <!-- MOBILE ADAPTATION: –ö–Ω–æ–ø–∫–∏ - –∞–¥–∞–ø—Ç–∏–≤–Ω—ñ -->
                <div class="flex flex-col sm:flex-row justify-end space-y-2 sm:space-y-0 sm:space-x-4 mt-6">
                    <button type="button" id="notify-cancel-btn" class="primary-btn bg-gray-400 hover:bg-gray-500 shadow-gray-600 w-full sm:w-auto">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
                    <button type="submit" id="notify-send-btn" class="primary-btn bg-success-green hover:bg-green-600 shadow-green-700 flex items-center justify-center w-full sm:w-auto">
                        –í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏
                    </button>
                </div>
                <p id="notify-error" class="text-red-500 text-sm hidden text-center"></p>
            </form>
        </div>
    </div>

    <!-- NEW: –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –¥–ª—è –ø–µ—Ä—à–æ–≥–æ –≤—ñ–¥–≤—ñ–¥—É–≤–∞–Ω–Ω—è -->
    <div id="first-visit-dialog" class="dialog-overlay">
        <div class="dialog-content">
            <p class="text-xl font-semibold text-gray-800 mb-8">
                –ü—Ä–∏–≤—ñ—Ç! üëã –õ–∞—Å–∫–∞–≤–æ –ø—Ä–æ—Å–∏–º–æ –¥–æ ObshchagaSHOP!
                <br><br>
                –©–æ–± –º–∞—Ç–∏ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –æ—Ñ–æ—Ä–º–ª—é–≤–∞—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è —Ç–∞ –æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è –ø—Ä–æ —ó—Ö —Å—Ç–∞—Ç—É—Å, –±—É–¥—å –ª–∞—Å–∫–∞,
                –∑–∞–π–¥—ñ—Ç—å —É –Ω–∞—à Telegram –±–æ—Ç:
                <br><br>
                <a href="https://t.me/obschaga10shop_bot" target="_blank"
                    class="text-accent-blue hover:underline font-bold text-2xl">
                    @obschaga10shop_bot
                </a>
                <br><br>
                —Ç–∞ –≤—ñ–¥–ø—Ä–∞–≤—Ç–µ –π–æ–º—É –∫–æ–º–∞–Ω–¥—É `/start`.
            </p>
            <div class="dialog-actions flex justify-center">
                <button id="first-visit-ok-btn" class="primary-btn">–ó—Ä–æ–∑—É–º—ñ–ª–æ</button>
            </div>
        </div>
    </div>


    <script>
        // *** –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø API ***
        const API_BASE_URL = 'products_api.php';
        const UPLOAD_DIR = 'uploads/';
        const WEBSITE_BASE_URL = 'https://www.obshchaga10shop.website/'; // <--- –í–ê–® –†–ï–ê–õ–¨–ù–ò–ô –î–û–ú–ï–ù –ú–ê–ì–ê–ó–ò–ù–£!
        const ADMIN_SECRET_PATH = '#admin-panel-secret'; // –°–µ–∫—Ä–µ—Ç–Ω–∏–π —à–ª—è—Ö –¥–ª—è –∞–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—ñ

        // --- –ì–õ–û–ë–ê–õ–¨–ù–Ü –ó–ú–Ü–ù–ù–Ü ---
        let products = [];
        let categories = [];
        let customers = []; // New global variable for customers
        let orders = []; // NEW: Global variable for orders
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        let isAdminLoggedIn = false;
        const DELIVERY_COST = 50.00;

        // --- DOM –ï–õ–ï–ú–ï–ù–¢–ò ---
        const pages = document.querySelectorAll('.page');
        const navLinks = document.querySelectorAll('.nav-link');
        const productsContainer = document.getElementById('products-container');
        const loadingIndicator = document.getElementById('loading');
        const errorMessage = document.getElementById('error-message');
        const adminProductsList = document.getElementById('admin-products-list');
        const cartCountElement = document.getElementById('cart-count');
        const checkoutBtn = document.getElementById('checkout-btn');
        const addProductSpinner = document.getElementById('add-product-spinner');
        const cartTotalElement = document.getElementById('cart-total');
        const needsDeliveryCheckbox = document.getElementById('needs-delivery');
        const customerInfoForm = document.getElementById('customer-info-form');
        const logoLink = document.getElementById('logo-link'); // –î–æ–¥–∞–Ω–æ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ª–æ–≥–æ—Ç–∏–ø
        const searchInput = document.getElementById('search-input'); // –î–æ–¥–∞–Ω–æ –ø–æ–ª–µ –ø–æ—à—É–∫—É

        // –ï–ª–µ–º–µ–Ω—Ç–∏ –î—ñ–∞–ª–æ–≥—É
        const dialogBox = document.getElementById('dialog-box');
        const dialogMessage = document.getElementById('dialog-message');
        const dialogAlertBtn = document.getElementById('dialog-alert-btn');
        const dialogConfirmBtn = document.getElementById('dialog-confirm-btn');
        const dialogCancelBtn = document.getElementById('dialog-cancel-btn');
        let dialogResolve = null;

        // –ï–ª–µ–º–µ–Ω—Ç–∏ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è —Ç–æ–≤–∞—Ä—É
        const editProductModal = document.getElementById('edit-product-modal');
        const editProductForm = document.getElementById('edit-product-form');
        const editProductId = document.getElementById('edit-product-id');
        const editProductName = document.getElementById('edit-product-name');
        const editProductDescription = document.getElementById('edit-product-description');
        const editProductPrice = document.getElementById('edit-product-price');
        const editProductStock = document.getElementById('edit-product-stock');
        const editProductImageFile = document.getElementById('edit-product-image-file');
        const editProductImageUrl = document.getElementById('edit-product-image-url');
        const editCurrentImagePreview = document.getElementById('edit-current-image-preview');
        const editProductDiscount = document.getElementById('edit-product-discount');
        const editProductOnSale = document.getElementById('edit-product-on-sale');
        const editProductSpinner = document.getElementById('edit-product-spinner');
        const editProductError = document.getElementById('edit-product-error');
        const cancelEditBtn = document.getElementById('cancel-edit-btn');
        const editImageUrlChanged = document.getElementById('edit-image-url-changed');
        const editProductCategorySelect = document.getElementById('edit-product-category-select');

        // –ï–ª–µ–º–µ–Ω—Ç–∏ —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó —Ç–∞ —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è
        const categoryFilter = document.getElementById('category-filter');
        const sortFilter = document.getElementById('sort-filter');

        // –ï–ª–µ–º–µ–Ω—Ç–∏ –∞–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—ñ –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä—ñ–π
        const addCategoryForm = document.getElementById('add-category-form');
        const categoryNameInput = document.getElementById('category-name-input');
        const addCategoryError = document.getElementById('add-category-error');
        const adminCategoriesList = document.getElementById('admin-categories-list');
        const productCategorySelect = document.getElementById('product-category-select'); // –î–ª—è —Ñ–æ—Ä–º–∏ –¥–æ–¥–∞–≤–∞–Ω–Ω—è —Ç–æ–≤–∞—Ä—É

        // –ï–ª–µ–º–µ–Ω—Ç–∏ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó
        const editCategoryModal = document.getElementById('edit-category-modal');
        const editCategoryForm = document.getElementById('edit-category-form');
        const editCategoryId = document.getElementById('edit-category-id');
        const editCategoryName = document.getElementById('edit-category-name');
        const cancelEditCategoryBtn = document.getElementById('cancel-edit-category-btn');
        const editCategoryError = document.getElementById('edit-category-error');

        // –ï–ª–µ–º–µ–Ω—Ç–∏ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞ –≤–ª–∞—Å–Ω–æ–≥–æ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è (—Ç–µ–ø–µ—Ä –∑–∞–≥–∞–ª—å–Ω–æ–≥–æ)
        const openGeneralNotifyModalBtn = document.getElementById('open-general-notify-modal-btn');
        const customNotifyModal = document.getElementById('custom-notify-modal');
        const customNotifyForm = document.getElementById('custom-notify-form');
        const notifyMessageText = document.getElementById('notify-message-text');
        const notifyImageFile = document.getElementById('notify-image-file');
        const notifyCancelBtn = document.getElementById('notify-cancel-btn');
        const notifySendBtn = document.getElementById('notify-send-btn');
        const notifyError = document.getElementById('notify-error');

        // –ï–ª–µ–º–µ–Ω—Ç–∏ –¥–ª—è —ñ–º–ø–æ—Ä—Ç—É CSV
        const importCsvForm = document.getElementById('import-csv-form');
        const csvFileInput = document.getElementById('csv-file-input');
        const importCsvBtn = document.getElementById('import-csv-btn');
        const importCsvSpinner = document.getElementById('import-csv-spinner');
        const importCsvError = document.getElementById('import-csv-error');
        const importCsvSuccess = document.getElementById('import-csv-success');
        const exportCsvSampleBtn = document.getElementById('export-csv-sample-btn'); // –ù–æ–≤–∞ –∫–Ω–æ–ø–∫–∞

        // –ï–ª–µ–º–µ–Ω—Ç–∏ –¥–ª—è —Å–ø–∏—Å–∫—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
        const adminCustomersList = document.getElementById('admin-customers-list');
        const refreshCustomersBtn = document.getElementById('refresh-customers-btn');

        // NEW: –ï–ª–µ–º–µ–Ω—Ç–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è–º–∏
        const adminNavBtns = document.querySelectorAll('.admin-nav-btn');
        const adminSections = document.querySelectorAll('.admin-section');
        const adminOrdersList = document.getElementById('admin-orders-list');
        const orderStatusFilter = document.getElementById('order-status-filter');
        const refreshOrdersBtn = document.getElementById('refresh-orders-btn');

        // NEW: –ï–ª–µ–º–µ–Ω—Ç–∏ –¥–ª—è –ø–µ—Ä—à–æ–≥–æ –≤—ñ–¥–≤—ñ–¥—É–≤–∞–Ω–Ω—è
        const firstVisitDialog = document.getElementById('first-visit-dialog');
        const firstVisitOkBtn = document.getElementById('first-visit-ok-btn');


        // --- –£–¢–ò–õ–Ü–¢–ò (–ó–∞–º—ñ–Ω–∞ alert/confirm) ---

        function showAlert(message) {
            dialogConfirmBtn.classList.add('hidden');
            dialogCancelBtn.classList.add('hidden');
            dialogAlertBtn.classList.remove('hidden');
            dialogMessage.textContent = message;
            dialogBox.classList.add('dialog-show');
        }

        function showConfirm(message) {
            return new Promise(resolve => {
                dialogResolve = resolve;
                dialogAlertBtn.classList.add('hidden');
                dialogConfirmBtn.classList.remove('hidden');
                dialogCancelBtn.classList.remove('hidden');
                dialogMessage.textContent = message;
                dialogBox.classList.add('dialog-show');
            });
        }

        // –û–±—Ä–æ–±–Ω–∏–∫–∏ –î—ñ–∞–ª–æ–≥—É
        dialogAlertBtn.onclick = () => dialogBox.classList.remove('dialog-show');
        dialogConfirmBtn.onclick = () => {
            if (dialogResolve) dialogResolve(true);
            dialogBox.classList.remove('dialog-show');
        };
        dialogCancelBtn.onclick = () => {
            if (dialogResolve) dialogResolve(false);
            dialogBox.classList.remove('dialog-show');
        };

        // –û–±—Ä–æ–±–Ω–∏–∫–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è —Ç–æ–≤–∞—Ä—É
        cancelEditBtn.addEventListener('click', () => {
            editProductModal.classList.remove('dialog-show');
            editProductForm.reset();
            editProductError.classList.add('hidden');
        });

        editProductImageUrl.addEventListener('input', () => {
            editImageUrlChanged.value = 'true';
        });
        editProductImageFile.addEventListener('change', () => {
            if (editProductImageFile.files.length > 0) {
                editProductImageUrl.value = '';
                editImageUrlChanged.value = 'true';
            }
        });

        // --- –ù–ê–í–Ü–ì–ê–¶–Ü–Ø ---

        function showPage(pageId) {
            pages.forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(pageId + '-page').classList.add('active');

            navLinks.forEach(link => {
                if (link.getAttribute('data-page') === pageId) {
                    link.classList.add('active-link');
                } else {
                    link.classList.remove('active-link');
                }
            });

            if (pageId === 'products') {
                fetchProducts();
            } else if (pageId === 'cart') {
                renderCart();
            } else if (pageId === 'admin') {
                checkAdminAuth();
            }
        }

        // –û–±—Ä–æ–±–Ω–∏–∫ –∫–ª—ñ–∫—É –ø–æ –ª–æ–≥–æ—Ç–∏–ø—É
        logoLink.addEventListener('click', (e) => {
            e.preventDefault();
            window.location.hash = '#products'; // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫—É —Ç–æ–≤–∞—Ä—ñ–≤
            showPage('products');
        });

        // --- API –¢–ê –†–ï–ù–î–ï–†–ò–ù–ì –¢–û–í–ê–†–Ü–í ---

        async function fetchCategories() {
            try {
                const response = await fetch(API_BASE_URL + '?action=get_categories');
                const data = await response.json();
                if (data.status === 'success') {
                    categories = data.data;
                    categoryFilter.innerHTML = '<option value="">–í—Å—ñ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó</option>';
                    categories.forEach(cat => {
                        const option = document.createElement('option');
                        option.value = cat.id;
                        option.textContent = cat.name;
                        categoryFilter.appendChild(option);
                    });
                } else {
                    console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∫–∞—Ç–µ–≥–æ—Ä—ñ–π:', data.message);
                }
            } catch (error) {
                console.error('Fetch Categories Error:', error);
            }
        }

        async function fetchProducts() {
            productsContainer.innerHTML = '';
            loadingIndicator.classList.remove('hidden');
            errorMessage.classList.add('hidden');

            try {
                let url = API_BASE_URL + '?action=get_products';
                const categoryId = categoryFilter.value;
                const sort = sortFilter.value;
                const searchTerm = searchInput.value.trim(); // –û—Ç—Ä–∏–º—É—î–º–æ –∑–Ω–∞—á–µ–Ω–Ω—è –ø–æ—à—É–∫—É

                if (categoryId) url += '&category_id=' + encodeURIComponent(categoryId);
                if (sort) url += '&sort=' + encodeURIComponent(sort);
                if (searchTerm) url += '&search=' + encodeURIComponent(searchTerm); // –î–æ–¥–∞—î–º–æ –ø–∞—Ä–∞–º–µ—Ç—Ä –ø–æ—à—É–∫—É

                const response = await fetch(url);
                const data = await response.json();

                if (data.status === 'success') {
                    products = data.data.map(p => ({
                        ...p,
                        in_stock: parseInt(p.in_stock),
                        discount_percentage: parseInt(p.discount_percentage),
                        is_on_sale: Boolean(p.is_on_sale)
                    }));
                    renderProducts();
                    renderCart();
                    
                    // –Ø–∫—â–æ –∞–¥–º—ñ–Ω –∑–∞–ª–æ–≥—ñ–Ω–µ–Ω–∏–π - –æ–Ω–æ–≤–∏—Ç–∏ –∞–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å
                    if (isAdminLoggedIn) {
                        renderAdminProducts();
                    }
                } else {
                    throw new Error(data.message || '–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –æ—Ç—Ä–∏–º–∞–Ω–Ω—ñ –¥–∞–Ω–∏—Ö –∑ API.');
                }
            } catch (error) {
                console.error("Fetch Error:", error);
                errorMessage.textContent = `–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö: ${error.message}. –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ —Å–µ—Ä–≤–µ—Ä/MySQL –∑–∞–ø—É—â–µ–Ω—ñ, –∞ URL –∑–æ–±—Ä–∞–∂–µ–Ω—å –¥–æ—Å—Ç—É–ø–Ω—ñ.`;
                errorMessage.classList.remove('hidden');
            } finally {
                loadingIndicator.classList.add('hidden');
            }
        }

        function renderProducts() {
            productsContainer.innerHTML = '';
            if (products.length === 0) {
                productsContainer.innerHTML = '<p class="col-span-full text-center text-gray-500 text-lg">–¢–æ–≤–∞—Ä–∏ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ. –î–æ–¥–∞–π—Ç–µ —ó—Ö —á–µ—Ä–µ–∑ –ê–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å.</p>';
                return;
            }

            products.forEach(product => {
                const productElement = document.createElement('div');
                productElement.className = 'product-card bg-white rounded-xl shadow-md flex flex-col items-center text-center';

                let imageUrl = '';
                if (product.image_url && product.image_url.startsWith('http')) {
                    imageUrl = product.image_url;
                } else if (product.image_url) {
                    imageUrl = UPLOAD_DIR + product.image_url;
                } else {
                    imageUrl = 'https://placehold.co/192x192/94a3b8/ffffff?text=–ù–ï–ú–ê–Ñ+–§–û–¢–û';
                }

                let priceHtml = `<p class="text-3xl font-extrabold text-success-green mb-2">${product.price.toFixed(2)} –≥—Ä–Ω</p>`;
                if (product.is_on_sale && product.discount_percentage > 0) {
                    const discountedPrice = product.price * (1 - product.discount_percentage / 100);
                    priceHtml = `
                        <p class="text-3xl font-extrabold text-success-green mb-2 flex items-center justify-center">
                            <span class="original-price">${product.price.toFixed(2)} –≥—Ä–Ω</span>
                            ${discountedPrice.toFixed(2)} –≥—Ä–Ω
                            <span class="discount-badge">-${product.discount_percentage}%</span>
                        </p>
                    `;
                }

                productElement.innerHTML = `
                    <div class="w-48 h-48 mb-4 overflow-hidden rounded-lg border border-gray-100 shadow-sm">
                        <img
                            src="${imageUrl}"
                            alt="${product.name}"
                            class="w-full h-full object-cover transition duration-300 ease-in-out hover:scale-105"
                            onerror="this.onerror=null; this.src='https://placehold.co/192x192/94a3b8/ffffff?text=–ù–ï–ú–ê–Ñ+–§–û–¢–û'; this.style.fontSize='14px';"
                            loading="lazy"
                        >
                    </div>
                    <h3 class="text-xl font-bold text-gray-800 mb-1">${product.name}</h3>
                    ${priceHtml}
                    <span class="product-availability ${product.in_stock > 0 ? 'in-stock' : 'out-of-stock'}">
                        ${product.in_stock > 0 ? `–í –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ (${product.in_stock} —à—Ç.)` : '–ù–µ–º–∞—î –≤ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ'}
                    </span>
                    <button
                        class="primary-btn w-full text-base py-2.5 mt-4 ${product.in_stock === 0 ? 'opacity-50 cursor-not-allowed' : ''}"
                        data-id="${product.id}"
                        ${product.in_stock === 0 ? 'disabled' : ''}
                    >
                        –î–æ –∫–æ—à–∏–∫–∞
                    </button>
                    <div class="product-description-wrapper">
                        ${product.description ? `<p>${product.description}</p>` : ''}
                    </div>
                `;
                productsContainer.appendChild(productElement);
            });

            document.querySelectorAll('.primary-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    if(e.target.dataset.id) {
                         addToCart(e.target.dataset.id);
                    }
                });
            });
        }

        categoryFilter.addEventListener('change', fetchProducts);
        sortFilter.addEventListener('change', fetchProducts);
        searchInput.addEventListener('input', fetchProducts); // –î–æ–¥–∞–Ω–æ –æ–±—Ä–æ–±–Ω–∏–∫ –¥–ª—è –ø–æ–ª—è –ø–æ—à—É–∫—É

        // --- –õ–û–ì–Ü–ö–ê –ö–û–®–ò–ö–ê (LOCAL) ---

        function saveCart() {
            localStorage.setItem('cart', JSON.stringify(cart));
            updateCartCounter();
        }

        function updateCartCounter() {
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            cartCountElement.textContent = totalItems;

            if (totalItems > 0) {
                cartCountElement.classList.add('active');
                checkoutBtn.disabled = false;
                checkoutBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            } else {
                cartCountElement.classList.remove('active');
                checkoutBtn.disabled = true;
                checkoutBtn.classList.add('opacity-50', 'cursor-not-allowed');
            }
            updateCartTotal();
        }

        function addToCart(productId) {
            const product = products.find(p => p.id == productId);
            if (!product) {
                showAlert("–¢–æ–≤–∞—Ä –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ.");
                return;
            }
            if (product.in_stock <= 0) {
                showAlert("–¶—å–æ–≥–æ —Ç–æ–≤–∞—Ä—É –Ω–µ–º–∞—î –≤ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ.");
                return;
            }

            const existingItem = cart.find(item => item.id == productId);

            if (existingItem) {
                if (existingItem.quantity < product.in_stock) {
                    existingItem.quantity += 1;
                } else {
                    showAlert(`–í–∏ –Ω–µ –º–æ–∂–µ—Ç–µ –¥–æ–¥–∞—Ç–∏ –±—ñ–ª—å—à–µ ${product.in_stock} —à—Ç. —Ç–æ–≤–∞—Ä—É "${product.name}".`);
                    return;
                }
            } else {
                cart.push({
                    id: productId,
                    quantity: 1
                });
            }

            saveCart();
            renderCart();

            const cartNavItem = document.getElementById('cart-nav-item');
            cartNavItem.classList.add('cart-bump');
            setTimeout(() => {
                cartNavItem.classList.remove('cart-bump');
            }, 300);
        }

        function renderCart() {
            const cartItemsContainer = document.getElementById('cart-items');
            cartItemsContainer.innerHTML = '';
            let currentTotal = 0;

            if (cart.length === 0) {
                cartItemsContainer.innerHTML = '<p class="text-gray-500 text-lg p-4 bg-gray-50 rounded-lg">–ö–æ—à–∏–∫ –ø–æ—Ä–æ–∂–Ω—ñ–π. –î–æ–¥–∞–π—Ç–µ —â–æ—Å—å —ñ–∑ –∫–∞—Ç–∞–ª–æ–≥—É!</p>';
            }

            cart.forEach(item => {
                const product = products.find(p => p.id == item.id);

                if (!product) {
                    return;
                }

                let itemPrice = product.price;
                if (product.is_on_sale && product.discount_percentage > 0) {
                    itemPrice = product.price * (1 - product.discount_percentage / 100);
                }

                const itemTotal = itemPrice * item.quantity;
                currentTotal += itemTotal;

                let imageUrl = '';
                if (product.image_url && product.image_url.startsWith('http')) {
                    imageUrl = product.image_url;
                } else if (product.image_url) {
                    imageUrl = UPLOAD_DIR + product.image_url;
                } else {
                    imageUrl = 'https://placehold.co/64x64/94a3b8/ffffff?text=X';
                }

                let priceDisplay = `${itemPrice.toFixed(2)} –≥—Ä–Ω`;
                if (product.is_on_sale && product.discount_percentage > 0) {
                    priceDisplay = `<span class="original-price">${product.price.toFixed(2)}</span> ${itemPrice.toFixed(2)} –≥—Ä–Ω (-${product.discount_percentage}%)`;
                }

                const itemElement = document.createElement('div');
                // MOBILE ADAPTATION: –ï–ª–µ–º–µ–Ω—Ç–∏ –∫–æ—à–∏–∫–∞ - –∞–¥–∞–ø—Ç–∏–≤–Ω—ñ
                itemElement.className = 'cart-item flex flex-col sm:flex-row items-start sm:items-center bg-white p-3 sm:p-4 rounded-xl shadow-sm hover:shadow-md transition duration-200 border border-border-light';
                itemElement.innerHTML = `
                    <div class="flex items-center space-x-3 sm:space-x-4 flex-grow w-full sm:w-auto mb-2 sm:mb-0">
                        <img
                            src="${imageUrl}"
                            alt="${product.name}"
                            class="w-12 h-12 sm:w-16 sm:h-16 object-cover rounded-lg border border-gray-200"
                            onerror="this.onerror=null; this.src='https://placehold.co/64x64/94a3b8/ffffff?text=X';"
                            loading="lazy"
                        >
                        <div class="flex flex-col min-w-0 flex-grow">
                            <div class="text-base sm:text-lg font-bold text-gray-800 truncate">${product.name}</div>
                            <div class="text-xs sm:text-sm text-gray-600">${priceDisplay} / —à—Ç</div>
                        </div>
                    </div>
                    <div class="flex items-center justify-between sm:justify-end space-x-3 sm:space-x-4 ml-0 sm:ml-auto w-full sm:w-auto">
                        <div class="flex items-center border border-gray-300 rounded-lg overflow-hidden">
                            <button class="quantity-btn minus text-lg sm:text-xl w-7 h-7 sm:w-8 sm:h-8 bg-gray-100 hover:bg-gray-200 transition" data-id="${item.id}">-</button>
                            <span class="px-2 sm:px-3 font-semibold text-sm sm:text-base">${item.quantity}</span>
                            <button class="quantity-btn plus text-lg sm:text-xl w-7 h-7 sm:w-8 sm:h-8 bg-gray-100 hover:bg-gray-200 transition" data-id="${item.id}">+</button>
                        </div>
                        <div class="text-base sm:text-xl font-bold text-header-dark w-20 sm:w-24 text-right">${itemTotal.toFixed(2)} –≥—Ä–Ω</div>
                        <button class="remove-btn text-red-500 hover:text-red-700 transition" data-id="${item.id}" aria-label="–í–∏–¥–∞–ª–∏—Ç–∏">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 sm:h-6 sm:w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>
                `;
                cartItemsContainer.appendChild(itemElement);
            });

            saveCart();
            updateCartTotal();

            document.querySelectorAll('.quantity-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const id = e.currentTarget.dataset.id;
                    const change = e.currentTarget.classList.contains('plus') ? 1 : -1;
                    updateCartQuantity(id, change);
                });
            });
            document.querySelectorAll('.remove-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    removeFromCart(e.currentTarget.dataset.id);
                });
            });
        }

        function updateCartQuantity(productId, change) {
            const item = cart.find(i => i.id == productId);
            if (item) {
                const product = products.find(p => p.id == productId);
                if (change > 0 && item.quantity >= product.in_stock) {
                    showAlert(`–í–∏ –Ω–µ –º–æ–∂–µ—Ç–µ –¥–æ–¥–∞—Ç–∏ –±—ñ–ª—å—à–µ ${product.in_stock} —à—Ç. —Ç–æ–≤–∞—Ä—É "${product.name}".`);
                    return;
                }
                item.quantity += change;
                if (item.quantity <= 0) {
                    removeFromCart(productId);
                } else {
                    saveCart();
                    renderCart();
                }
            }
        }

        function removeFromCart(productId) {
            cart = cart.filter(item => item.id != productId);
            saveCart();
            renderCart();
        }

        function updateCartTotal() {
            let total = cart.reduce((sum, item) => {
                const product = products.find(p => p.id == item.id);
                if (!product) return sum;

                let itemPrice = product.price;
                if (product.is_on_sale && product.discount_percentage > 0) {
                    itemPrice = product.price * (1 - product.discount_percentage / 100);
                }
                return sum + (itemPrice * item.quantity);
            }, 0);

            if (needsDeliveryCheckbox.checked) {
                total += DELIVERY_COST;
            }
            cartTotalElement.textContent = total.toFixed(2);
        }

        needsDeliveryCheckbox.addEventListener('change', updateCartTotal);

        // --- –§–£–ù–ö–¶–Ü–û–ù–ê–õ –û–§–û–†–ú–õ–ï–ù–ù–Ø –ó–ê–ú–û–í–õ–ï–ù–ù–Ø (TELEGRAM BOT API) ---

        customerInfoForm.addEventListener('submit', placeOrder);

        async function placeOrder(e) {
            e.preventDefault();

            if (cart.length === 0) {
                showAlert('–ö–æ—à–∏–∫ –ø–æ—Ä–æ–∂–Ω—ñ–π. –î–æ–¥–∞–π—Ç–µ —Ç–æ–≤–∞—Ä–∏, —â–æ–± –æ—Ñ–æ—Ä–º–∏—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è.');
                return;
            }

            const customerName = document.getElementById('customer-name').value.trim();
            const customerTelegram = document.getElementById('customer-telegram').value.trim();
            const customerPhone = document.getElementById('customer-phone').value.trim();
            const customerAddress = document.getElementById('customer-address').value.trim();
            const needsDelivery = needsDeliveryCheckbox.checked;
            let total = parseFloat(cartTotalElement.textContent);

            if (!customerName || !customerPhone || !customerTelegram) {
                showAlert('–ë—É–¥—å –ª–∞—Å–∫–∞, –∑–∞–ø–æ–≤–Ω—ñ—Ç—å —É—Å—ñ –æ–±–æ–≤\'—è–∑–∫–æ–≤—ñ –ø–æ–ª—è: –í–∞—à–µ —ñ–º\'—è, –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É —Ç–∞ –í–∞—à –Ω—ñ–∫ —É Telegram.');
                return;
            }
            if (needsDelivery && !customerAddress) {
                showAlert('–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–∫–∞–∂—ñ—Ç—å –∫—ñ–º–Ω–∞—Ç—É –¥–æ—Å—Ç–∞–≤–∫–∏, —è–∫—â–æ –æ–±—Ä–∞–Ω–æ –¥–æ—Å—Ç–∞–≤–∫—É.');
                return;
            }

            const confirmed = await showConfirm(`–ü—ñ–¥—Ç–≤–µ—Ä–¥—å—Ç–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –Ω–∞ —Å—É–º—É ${total.toFixed(2)} –≥—Ä–Ω.`);
            if (!confirmed) return;

            const orderData = {
                action: 'place_order',
                customer: {
                    name: customerName,
                    telegram: customerTelegram,
                    phone: customerPhone,
                    address: customerAddress,
                    needs_delivery: needsDelivery
                },
                items: cart.map(item => {
                    const product = products.find(p => p.id == item.id);
                    let itemPrice = product ? product.price : 0;
                    if (product && product.is_on_sale && product.discount_percentage > 0) {
                        itemPrice = product.price * (1 - product.discount_percentage / 100);
                    }
                    return {
                        id: item.id, // NEW: Add product ID
                        name: product ? product.name : '–ù–µ–≤—ñ–¥–æ–º–∏–π —Ç–æ–≤–∞—Ä',
                        price: itemPrice,
                        quantity: item.quantity
                    };
                }),
                total_amount: total
            };

            try {
                checkoutBtn.innerHTML = '<div id="api-spinner"></div> –û—Ñ–æ—Ä–º–ª–µ–Ω–Ω—è...';
                checkoutBtn.disabled = true;

                const response = await fetch(API_BASE_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(orderData)
                });
                const result = await response.json();

                if (result.status === 'success') {
                    showAlert("‚úÖ –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è —É—Å–ø—ñ—à–Ω–æ –æ—Ñ–æ—Ä–º–ª–µ–Ω–æ! –ú–∏ –∑–≤'—è–∂–µ–º–æ—Å—è –∑ –≤–∞–º–∏ –Ω–∞–π–±–ª–∏–∂—á–∏–º —á–∞—Å–æ–º.");
                    cart = [];
                    saveCart();
                    renderCart();
                    customerInfoForm.reset();
                    showPage('products');
                } else {
                    throw new Error(result.message || '–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–Ω—ñ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è.');
                }
            } catch (error) {
                console.error('Place Order Error:', error);
                showAlert(`–ü–æ–º–∏–ª–∫–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è: ${error.message}. –ë—É–¥—å –ª–∞—Å–∫–∞, —Å–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑.`);
            } finally {
                checkoutBtn.innerHTML = '–û—Ñ–æ—Ä–º–∏—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è';
                checkoutBtn.disabled = false;
                updateCartCounter();
            }
        }


        // --- –õ–û–ì–Ü–ö–ê –ê–î–ú–Ü–ù–Ü–°–¢–†–ê–¢–û–†–ê ---

        function checkAdminAuth() {
            const loginArea = document.getElementById('admin-login-area');
            const contentArea = document.getElementById('admin-content');

            // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ –ø–æ—Ç–æ—á–Ω–∏–π URL –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î —Å–µ–∫—Ä–µ—Ç–Ω–æ–º—É —à–ª—è—Ö—É
            if (window.location.hash === ADMIN_SECRET_PATH) {
                if (localStorage.getItem('adminAuth') === 'true') {
                    isAdminLoggedIn = true;
                    loginArea.classList.add('hidden');
                    contentArea.classList.remove('hidden');
                    
                    // NEW: Show default admin section (e.g., products management)
                    showAdminSection('products-management');
                    
                    fetchAdminCategories(); // –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó –¥–ª—è –∞–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—ñ
                    fetchProducts(); // –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ —Ç–æ–≤–∞—Ä–∏ (—Ü–µ —Ç–∞–∫–æ–∂ –≤–∏–∫–ª–∏—á–µ renderAdminProducts —á–µ—Ä–µ–∑ isAdminLoggedIn)
                    fetchCustomers(); // Fetch customers when admin logs in
                    fetchOrders(); // NEW: Fetch orders when admin logs in
                } else {
                    isAdminLoggedIn = false;
                    loginArea.classList.remove('hidden');
                    contentArea.classList.add('hidden');
                }
            } else {
                // –Ø–∫—â–æ URL –Ω–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î —Å–µ–∫—Ä–µ—Ç–Ω–æ–º—É —à–ª—è—Ö—É, –ø—Ä–∏—Ö–æ–≤—É—î–º–æ –∞–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å
                loginArea.classList.add('hidden');
                contentArea.classList.add('hidden');
                isAdminLoggedIn = false;
            }
        }

        // NEW: Function to switch admin sections
        function showAdminSection(sectionId) {
            adminSections.forEach(section => {
                section.classList.add('hidden');
            });
            document.getElementById(sectionId + '-section').classList.remove('hidden');

            adminNavBtns.forEach(btn => {
                if (btn.dataset.adminPage === sectionId) {
                    btn.classList.add('active-link'); // Use active-link style for active admin nav button
                } else {
                    btn.classList.remove('active-link');
                }
            });

            // Trigger data fetch for the active section
            if (sectionId === 'products-management') {
                fetchProducts(); // This will also call renderAdminProducts
            } else if (sectionId === 'orders-management') {
                fetchOrders();
            } else if (sectionId === 'users-management') {
                fetchCustomers();
            }
            // No specific fetch for notifications-management as it's just a form
        }

        // NEW: Event listeners for admin navigation buttons
        adminNavBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                showAdminSection(btn.dataset.adminPage);
            });
        });


        document.getElementById('admin-login-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            const username = document.getElementById('admin-username').value;
            const password = document.getElementById('admin-password').value;
            const errorElement = document.getElementById('login-error');

            errorElement.classList.add('hidden');

            try {
                const formData = new FormData();
                formData.append('action', 'admin_login');
                formData.append('username', username);
                formData.append('password', password);

                const response = await fetch(API_BASE_URL, {
                    method: 'POST',
                    body: formData
                });
                const result = await response.json();

                if (result.status === 'success' && result.authenticated) {
                    localStorage.setItem('adminAuth', 'true');
                    showAlert('–í—Ö—ñ–¥ –¥–æ –∞–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—ñ —É—Å–ø—ñ—à–Ω–∏–π!');
                    // –î–û–î–ê–ù–û: –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ —Ç–æ–≤–∞—Ä–∏ –ø—ñ—Å–ª—è —É—Å–ø—ñ—à–Ω–æ–≥–æ –≤—Ö–æ–¥—É
                    await fetchProducts();
                    checkAdminAuth(); // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—é —â–µ —Ä–∞–∑, —â–æ–± –æ–Ω–æ–≤–∏—Ç–∏ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å
                } else {
                    errorElement.textContent = result.message || '–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–µ —ñ–º\'—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∞–±–æ –ø–∞—Ä–æ–ª—å.';
                    errorElement.classList.remove('hidden');
                }
            } catch (error) {
                console.error('Admin Login Error:', error);
                errorElement.textContent = '–ü–æ–º–∏–ª–∫–∞ –≤—Ö–æ–¥—É. –°–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑.';
                errorElement.classList.remove('hidden');
            }
        });

        // --- –ö–µ—Ä—É–≤–∞–Ω–Ω—è –∫–∞—Ç–µ–≥–æ—Ä—ñ—è–º–∏ –≤ –∞–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—ñ ---
        async function fetchAdminCategories() {
            try {
                const response = await fetch(API_BASE_URL + '?action=get_categories');
                const data = await response.json();
                if (data.status === 'success') {
                    categories = data.data;
                    renderAdminCategories(); // –†–µ–Ω–¥–µ—Ä–∏–º–æ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó –≤ –∞–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—ñ
                    updateCategorySelects(); // –û–Ω–æ–≤–ª—é—î–º–æ –≤–∏–ø–∞–¥–∞—é—á—ñ —Å–ø–∏—Å–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ–π
                } else {
                    console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∫–∞—Ç–µ–≥–æ—Ä—ñ–π –¥–ª—è –∞–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—ñ:', data.message);
                }
            } catch (error) {
                console.error('Fetch Admin Categories Error:', error);
            }
        }

        function renderAdminCategories() {
            adminCategoriesList.innerHTML = '';
            if (categories.length === 0) {
                adminCategoriesList.innerHTML = '<p class="text-gray-500">–ö–∞—Ç–µ–≥–æ—Ä—ñ—ó –≤—ñ–¥—Å—É—Ç–Ω—ñ.</p>';
                return;
            }
            categories.forEach(cat => {
                const div = document.createElement('div');
                div.className = 'flex justify-between items-center p-2 bg-gray-50 rounded-md border border-gray-200';
                div.innerHTML = `
                    <span>${cat.name} (ID: ${cat.id})</span>
                    <div class="flex space-x-2">
                        <button class="edit-category-btn primary-btn bg-yellow-500 hover:bg-yellow-600 shadow-yellow-600 text-white px-3 py-1 rounded" data-id="${cat.id}" data-name="${cat.name}">–†–µ–¥–∞–≥—É–≤–∞—Ç–∏</button>
                        <button class="delete-category-btn primary-btn bg-danger-red hover:bg-red-700 shadow-red-700 text-white px-3 py-1 rounded" data-id="${cat.id}" data-name="${cat.name}">–í–∏–¥–∞–ª–∏—Ç–∏</button>
                    </div>
                `;
                adminCategoriesList.appendChild(div);
            });

            document.querySelectorAll('.edit-category-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    editCategoryId.value = btn.dataset.id;
                    editCategoryName.value = btn.dataset.name;
                    editCategoryError.classList.add('hidden');
                    editCategoryModal.classList.add('dialog-show');
                });
            });

            document.querySelectorAll('.delete-category-btn').forEach(btn => {
                btn.addEventListener('click', async () => {
                    const id = btn.dataset.id;
                    const name = btn.dataset.name;
                    const confirmed = await showConfirm(`–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ—é "${name}"?`);
                    if (!confirmed) return;

                    try {
                        const formData = new FormData();
                        formData.append('action', 'delete_category');
                        formData.append('id', id);

                        const response = await fetch(API_BASE_URL, {
                            method: 'POST',
                            body: formData
                        });
                        const result = await response.json();

                        if (result.status === 'success') {
                            showAlert(`–ö–∞—Ç–µ–≥–æ—Ä—ñ—é "${name}" —É—Å–ø—ñ—à–Ω–æ –≤–∏–¥–∞–ª–µ–Ω–æ.`);
                            await fetchAdminCategories();
                            await fetchCategories();
                        } else {
                            throw new Error(result.message || '–ü–æ–º–∏–ª–∫–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó.');
                        }
                    } catch (error) {
                        showAlert(`–ü–æ–º–∏–ª–∫–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó: ${error.message}`);
                    }
                });
            });
        }

        function updateCategorySelects() {
            // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –¥–ª—è —Ñ–æ—Ä–º–∏ –¥–æ–¥–∞–≤–∞–Ω–Ω—è —Ç–æ–≤–∞—Ä—É
            productCategorySelect.innerHTML = '<option value="">–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó</option>';
            categories.forEach(cat => {
                const option = document.createElement('option');
                option.value = cat.id;
                option.textContent = cat.name;
                productCategorySelect.appendChild(option);
            });

            // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –¥–ª—è —Ñ–æ—Ä–º–∏ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è —Ç–æ–≤–∞—Ä—É
            if (editProductCategorySelect) {
                editProductCategorySelect.innerHTML = '<option value="">–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó</option>';
                categories.forEach(cat => {
                    const option = document.createElement('option');
                    option.value = cat.id;
                    option.textContent = cat.name;
                    editProductCategorySelect.appendChild(option);
                });
            }
        }

        addCategoryForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const categoryName = categoryNameInput.value.trim();
            addCategoryError.classList.add('hidden');

            if (!categoryName) {
                addCategoryError.textContent = '–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó.';
                addCategoryError.classList.remove('hidden');
                return;
            }

            try {
                const formData = new FormData();
                formData.append('action', 'add_category');
                formData.append('name', categoryName);

                const response = await fetch(API_BASE_URL, {
                    method: 'POST',
                    body: formData
                });
                const result = await response.json();

                if (result.status === 'success') {
                    showAlert(`–ö–∞—Ç–µ–≥–æ—Ä—ñ—é "${categoryName}" —É—Å–ø—ñ—à–Ω–æ –¥–æ–¥–∞–Ω–æ!`);
                    categoryNameInput.value = '';
                    await fetchAdminCategories();
                    await fetchCategories();
                } else {
                    throw new Error(result.message || '–ü–æ–º–∏–ª–∫–∞ –¥–æ–¥–∞–≤–∞–Ω–Ω—è –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó.');
                }
            } catch (error) {
                addCategoryError.textContent = `–ü–æ–º–∏–ª–∫–∞: ${error.message}`;
                addCategoryError.classList.remove('hidden');
            }
        });

        // –û–±—Ä–æ–±–∫–∞ —Ñ–æ—Ä–º–∏ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó
        editCategoryForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const id = editCategoryId.value;
            const name = editCategoryName.value.trim();
            editCategoryError.classList.add('hidden');

            if (!name) {
                editCategoryError.textContent = '–Ü–º\'—è –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó –Ω–µ –º–æ–∂–µ –±—É—Ç–∏ –ø–æ—Ä–æ–∂–Ω—ñ–º.';
                editCategoryError.classList.remove('hidden');
                return;
            }

            try {
                const formData = new FormData();
                formData.append('action', 'update_category');
                formData.append('id', id);
                formData.append('name', name);

                const response = await fetch(API_BASE_URL, {
                    method: 'POST',
                    body: formData
                });
                const result = await response.json();

                if (result.status === 'success') {
                    showAlert('–ö–∞—Ç–µ–≥–æ—Ä—ñ—é —É—Å–ø—ñ—à–Ω–æ –æ–Ω–æ–≤–ª–µ–Ω–æ!');
                    editCategoryModal.classList.remove('dialog-show');
                    await fetchAdminCategories();
                    await fetchCategories();
                } else {
                    throw new Error(result.message || '–ü–æ–º–∏–ª–∫–∞ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó.');
                }
            } catch (error) {
                editCategoryError.textContent = `–ü–æ–º–∏–ª–∫–∞: ${error.message}`;
                editCategoryError.classList.remove('hidden');
            }
        });

        cancelEditCategoryBtn.addEventListener('click', () => {
            editCategoryModal.classList.remove('dialog-show');
            editCategoryError.classList.add('hidden');
        });


        document.getElementById('add-product-form').addEventListener('submit', addProduct);

        async function addProduct(e) {
            e.preventDefault();

            const name = document.getElementById('product-name').value;
            const description = document.getElementById('product-description').value;
            const price = parseFloat(document.getElementById('product-price').value);
            const imageFile = document.getElementById('product-image-file').files[0];
            const imageUrl = document.getElementById('product-image-url').value.trim();
            const in_stock = parseInt(document.getElementById('product-stock').value);
            const discount_percentage = parseInt(document.getElementById('product-discount').value);
            const is_on_sale = document.getElementById('product-on-sale').checked;
            const category_id = productCategorySelect.value || null;
            const errorElement = document.getElementById('add-product-error');

            errorElement.classList.add('hidden');

            if (!name || isNaN(price) || price <= 0 || isNaN(in_stock) || in_stock < 0 || isNaN(discount_percentage) || discount_percentage < 0 || discount_percentage > 100) {
                showAlert('–ë—É–¥—å –ª–∞—Å–∫–∞, –∑–∞–ø–æ–≤–Ω—ñ—Ç—å —É—Å—ñ –æ–±–æ–≤\'—è–∑–∫–æ–≤—ñ –ø–æ–ª—è –∫–æ—Ä–µ–∫—Ç–Ω–æ (–Ω–∞–∑–≤–∞, —Ü—ñ–Ω–∞ > 0, –Ω–∞—è–≤–Ω—ñ—Å—Ç—å >= 0, –∑–Ω–∏–∂–∫–∞ 0-100%).');
                return;
            }
            if (!imageFile && !imageUrl) {
                showAlert('–ë—É–¥—å –ª–∞—Å–∫–∞, –∑–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∞–±–æ –≤–∫–∞–∂—ñ—Ç—å URL –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è.');
                return;
            }

            addProductSpinner.innerHTML = '<div id="api-spinner"></div> –û—Ñ–æ—Ä–º–ª–µ–Ω–Ω—è...'; // –û–Ω–æ–≤–ª–µ–Ω–æ —Ç–µ–∫—Å—Ç
            addProductSpinner.style.display = 'inline-block'; // –ü–æ–∫–∞–∑–∞—Ç–∏ —Å–ø—ñ–Ω–µ—Ä

            try {
                const formData = new FormData();
                formData.append('action', 'add_product');
                formData.append('name', name);
                formData.append('description', description);
                formData.append('price', price);
                formData.append('in_stock', in_stock);
                formData.append('discount_percentage', discount_percentage);
                formData.append('is_on_sale', is_on_sale ? 1 : 0);
                if (category_id) formData.append('category_id', category_id);

                if (imageFile) {
                    formData.append('image_file', imageFile);
                } else if (imageUrl) {
                    formData.append('image_url', imageUrl);
                }

                const response = await fetch(API_BASE_URL, {
                    method: 'POST',
                    body: formData
                });
                const result = await response.json();

                if (result.status === 'success') {
                    showAlert('–¢–æ–≤–∞—Ä —É—Å–ø—ñ—à–Ω–æ –¥–æ–¥–∞–Ω–æ –¥–æ MySQL!');
                    document.getElementById('add-product-form').reset();
                    await fetchProducts(); // –û–Ω–æ–≤–ª—é—î–º–æ —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä—ñ–≤
                    if (isAdminLoggedIn) {
                        renderAdminProducts(); // –ü–µ—Ä–µ—Ä–µ–Ω–¥–µ—Ä–∏–º–æ –∞–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å
                    }
                } else {
                    throw new Error(result.message || '–ü–æ–º–∏–ª–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏ –¥–æ–¥–∞–≤–∞–Ω–Ω—ñ.');
                }
            } catch (error) {
                console.error('Add Product Error:', error);
                errorElement.textContent = `–ü–æ–º–∏–ª–∫–∞ –¥–æ–¥–∞–≤–∞–Ω–Ω—è: ${error.message}.`;
                errorElement.classList.remove('hidden');
            } finally {
                addProductSpinner.innerHTML = '';
                addProductSpinner.style.display = 'none'; // –ü—Ä–∏—Ö–æ–≤–∞—Ç–∏ —Å–ø—ñ–Ω–µ—Ä
            }
        }

        async function deleteProduct(productId, productName) {
            const confirmed = await showConfirm(`–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ "${productName}"?`);
            if (!confirmed) return;

            try {
                const formData = new FormData();
                formData.append('action', 'delete_product');
                formData.append('id', productId);

                const response = await fetch(API_BASE_URL, {
                    method: 'POST',
                    body: formData
                });
                const result = await response.json();

                if (result.status === 'success') {
                    showAlert(`–¢–æ–≤–∞—Ä "${productName}" —É—Å–ø—ñ—à–Ω–æ –≤–∏–¥–∞–ª–µ–Ω–æ –∑ MySQL.`);

                    cart = cart.filter(item => item.id != productId);
                    saveCart();

                    fetchProducts();
                } else {
                    throw new Error(result.message || '–ü–æ–º–∏–ª–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—ñ.');
                }
            } catch (error) {
                console.error('Delete Product Error:', error);
                showAlert(`–ü–æ–º–∏–ª–∫–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è: ${error.message}`);
            }
        }

        async function updateProductStock(productId, newStock) {
            try {
                const formData = new FormData();
                formData.append('action', 'update_product_stock');
                formData.append('id', productId);
                formData.append('in_stock', newStock);

                const response = await fetch(API_BASE_URL, {
                    method: 'POST',
                    body: formData
                });
                const result = await response.json();

                if (result.status === 'success') {
                    fetchProducts();
                } else {
                    throw new Error(result.message || '–ü–æ–º–∏–ª–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏ –æ–Ω–æ–≤–ª–µ–Ω–Ω—ñ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ.');
                }
            } catch (error) {
                console.error('Update Stock Error:', error);
                showAlert(`–ü–æ–º–∏–ª–∫–∞ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ: ${error.message}`);
            }
        }

        async function notifyCustomers(productId, productName, newStock) {
            const confirmed = await showConfirm(`–°–ø–æ–≤—ñ—Å—Ç–∏—Ç–∏ –≤—Å—ñ—Ö –ø—ñ–¥–ø–∏—Å–Ω–∏–∫—ñ–≤ –ø—Ä–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ —Ç–æ–≤–∞—Ä—É "${productName}" –¥–æ ${newStock} —à—Ç.?`);
            if (!confirmed) return;

            try {
                const formData = new FormData();
                formData.append('action', 'notify_stock_update');
                formData.append('product_id', productId);
                formData.append('product_name', productName);
                formData.append('new_stock', newStock);
                formData.append('website_url', WEBSITE_BASE_URL); // <--- –î–û–î–ê–ù–û: –ü–µ—Ä–µ–¥–∞—î–º–æ URL —Å–∞–π—Ç—É

                const response = await fetch(API_BASE_URL, {
                    method: 'POST',
                    body: formData
                });
                const result = await response.json();

                if (result.status === 'success') {
                    showAlert('–°–ø–æ–≤—ñ—â–µ–Ω–Ω—è —É—Å–ø—ñ—à–Ω–æ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ –ø—ñ–¥–ø–∏—Å–Ω–∏–∫–∞–º!');
                } else {
                    throw new Error(result.message || '–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤—ñ–¥–ø—Ä–∞–≤—Ü—ñ —Å–ø–æ–≤—ñ—â–µ–Ω—å.');
                }
            } catch (error) {
                console.error('Notify Customers Error:', error);
                showAlert(`–ü–æ–º–∏–ª–∫–∞ –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ —Å–ø–æ–≤—ñ—â–µ–Ω—å: ${error.message}`);
            }
        }

        function renderAdminProducts() {
            adminProductsList.innerHTML = '';
            if (products.length === 0) {
                adminProductsList.innerHTML = '<p class="text-gray-500">–ù–µ–º–∞—î —Ç–æ–≤–∞—Ä—ñ–≤ –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è.</p>';
                return;
            }

            products.forEach(product => {
                let imageUrl = '';
                if (product.image_url && product.image_url.startsWith('http')) {
                    imageUrl = product.image_url;
                } else if (product.image_url) {
                    imageUrl = UPLOAD_DIR + product.image_url;
                } else {
                    imageUrl = 'https://placehold.co/48x48/94a3b8/ffffff?text=X';
                }

                let priceDisplay = `${product.price.toFixed(2)} –≥—Ä–Ω`;
                if (product.is_on_sale && product.discount_percentage > 0) {
                    const discountedPrice = product.price * (1 - product.discount_percentage / 100);
                    priceDisplay = `<span class="original-price">${product.price.toFixed(2)}</span> ${discountedPrice.toFixed(2)} –≥—Ä–Ω (-${product.discount_percentage}%)`;
                }

                const categoryName = product.category_id ? (categories.find(c => c.id == product.category_id)?.name || '–ù–µ–≤—ñ–¥–æ–º–∞') : '–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó';

                const item = document.createElement('div');
                item.className = 'admin-product-item';
                item.innerHTML = `
                    <img
                        src="${imageUrl}"
                        alt="Preview"
                        class="w-12 h-12 object-cover rounded-md border border-gray-200"
                        onerror="this.onerror=null; this.src='https://placehold.co/48x48/94a3b8/ffffff?text=X';"
                        loading="lazy"
                    >
                    <div class="product-details">
                        <div class="name">${product.name}</div>
                        ${product.description ? `<div class="text-xs text-gray-500 truncate w-32 sm:w-64">${product.description}</div>` : ''}
                        <div class="price">${priceDisplay}</div>
                        <div class="text-xs text-gray-500">–ö–∞—Ç–µ–≥–æ—Ä—ñ—è: ${categoryName}</div>
                        <div class="id">ID: ${product.id}</div>
                    </div>
                    <div class="controls">
                        <input type="number" class="product-stock-input" data-id="${product.id}" value="${product.in_stock}" min="0">
                        <button data-id="${product.id}" data-name="${product.name}" data-stock="${product.in_stock}" class="notify-btn">
                            –°–ø–æ–≤—ñ—Å—Ç–∏—Ç–∏
                        </button>
                        <button data-id="${product.id}" class="edit-btn">
                            –†–µ–¥–∞–≥—É–≤–∞—Ç–∏
                        </button>
                        <button data-id="${product.id}" data-name="${product.name}" class="delete-admin-btn">
                            –í–∏–¥–∞–ª–∏—Ç–∏
                        </button>
                    </div>
                `;
                adminProductsList.appendChild(item);
            });

            document.querySelectorAll('.delete-admin-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const id = e.currentTarget.dataset.id;
                    const name = e.currentTarget.dataset.name;
                    deleteProduct(id, name);
                });
            });

            document.querySelectorAll('.product-stock-input').forEach(input => {
                input.addEventListener('change', (e) => {
                    const id = e.currentTarget.dataset.id;
                    const newStock = parseInt(e.currentTarget.value);
                    if (!isNaN(newStock) && newStock >= 0) {
                        updateProductStock(id, newStock);
                        const notifyButton = e.currentTarget.closest('.admin-product-item').querySelector('.notify-btn');
                        if (notifyButton) {
                            notifyButton.dataset.stock = newStock;
                        }
                    } else {
                        showAlert('–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å –∫–æ—Ä–µ–∫—Ç–Ω–µ —á–∏—Å–ª–æ –¥–ª—è –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ (>= 0).');
                        e.currentTarget.value = products.find(p => p.id == id).in_stock;
                    }
                });
            });

            document.querySelectorAll('.notify-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const id = e.currentTarget.dataset.id;
                    const name = e.currentTarget.dataset.name;
                    const stock = e.currentTarget.dataset.stock;
                    notifyCustomers(id, name, stock);
                });
            });

            document.querySelectorAll('.edit-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const id = e.currentTarget.dataset.id;
                    editProduct(id);
                });
            });
        }

        // --- –§–£–ù–ö–¶–Ü–û–ù–ê–õ –†–ï–î–ê–ì–£–í–ê–ù–ù–Ø –¢–û–í–ê–†–£ ---
        async function editProduct(productId) {
            const product = products.find(p => p.id == productId);
            if (!product) {
                showAlert('–¢–æ–≤–∞—Ä –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ –¥–ª—è —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è.');
                return;
            }

            editProductId.value = product.id;
            editProductName.value = product.name;
            editProductDescription.value = product.description || '';
            editProductPrice.value = product.price.toFixed(2);
            editProductStock.value = product.in_stock;
            editProductDiscount.value = product.discount_percentage;
            editProductOnSale.checked = product.is_on_sale;
            editProductCategorySelect.value = product.category_id || '';

            let currentImageUrl = '';
            if (product.image_url && product.image_url.startsWith('http')) {
                currentImageUrl = product.image_url;
            } else if (product.image_url) {
                currentImageUrl = UPLOAD_DIR + product.image_url;
            } else {
                currentImageUrl = 'https://placehold.co/96x96/94a3b8/ffffff?text=–ù–ï–ú–ê–Ñ+–§–û–¢–û';
            }
            editCurrentImagePreview.src = currentImageUrl;
            editProductImageUrl.value = product.image_url && product.image_url.startsWith('http') ? product.image_url : '';

            editProductImageFile.value = '';
            editImageUrlChanged.value = 'false';

            editProductError.classList.add('hidden');
            editProductModal.classList.add('dialog-show');
        }

        editProductForm.addEventListener('submit', saveEditedProduct);

        async function saveEditedProduct(e) {
            e.preventDefault();

            const id = editProductId.value;
            const name = editProductName.value;
            const description = editProductDescription.value;
            const price = parseFloat(editProductPrice.value);
            const in_stock = parseInt(editProductStock.value);
            const discount_percentage = parseInt(editProductDiscount.value);
            const is_on_sale = editProductOnSale.checked;
            const category_id = editProductCategorySelect.value || null;
            const imageFile = editProductImageFile.files[0];
            const imageUrl = editProductImageUrl.value.trim();
            const imageUrlChanged = editImageUrlChanged.value;

            editProductError.classList.add('hidden');

            if (!name || isNaN(price) || price <= 0 || isNaN(in_stock) || in_stock < 0 || isNaN(discount_percentage) || discount_percentage < 0 || discount_percentage > 100) {
                editProductError.textContent = '–ë—É–¥—å –ª–∞—Å–∫–∞, –∑–∞–ø–æ–≤–Ω—ñ—Ç—å —É—Å—ñ –æ–±–æ–≤\'—è–∑–∫–æ–≤—ñ –ø–æ–ª—è –∫–æ—Ä–µ–∫—Ç–Ω–æ (–Ω–∞–∑–≤–∞, —Ü—ñ–Ω–∞ > 0, –Ω–∞—è–≤–Ω—ñ—Å—Ç—å >= 0, –∑–Ω–∏–∂–∫–∞ 0-100%).';
                editProductError.classList.remove('hidden');
                return;
            }

            editProductSpinner.innerHTML = '<div id="api-spinner"></div> –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è...'; // –û–Ω–æ–≤–ª–µ–Ω–æ —Ç–µ–∫—Å—Ç
            editProductSpinner.style.display = 'inline-block'; // –ü–æ–∫–∞–∑–∞—Ç–∏ —Å–ø—ñ–Ω–µ—Ä

            try {
                const formData = new FormData();
                formData.append('action', 'update_product');
                formData.append('id', id);
                formData.append('name', name);
                formData.append('description', description);
                formData.append('price', price);
                formData.append('in_stock', in_stock);
                formData.append('discount_percentage', discount_percentage);
                formData.append('is_on_sale', is_on_sale ? 1 : 0);
                if (category_id) formData.append('category_id', category_id);
                formData.append('image_url_changed', imageUrlChanged);

                if (imageFile) {
                    formData.append('image_file', imageFile);
                } else {
                    formData.append('image_url', imageUrl);
                }

                const response = await fetch(API_BASE_URL, {
                    method: 'POST',
                    body: formData
                });
                const result = await response.json();

                if (result.status === 'success') {
                    showAlert('–¢–æ–≤–∞—Ä —É—Å–ø—ñ—à–Ω–æ –æ–Ω–æ–≤–ª–µ–Ω–æ!');
                    editProductModal.classList.remove('dialog-show');
                    fetchProducts();
                } else {
                    throw new Error(result.message || '–ü–æ–º–∏–ª–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏ –æ–Ω–æ–≤–ª–µ–Ω–Ω—ñ.');
                }
            } catch (error) {
                console.error('Update Product Error:', error);
                editProductError.textContent = `–ü–æ–º–∏–ª–∫–∞ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è: ${error.message}.`;
                editProductError.classList.remove('hidden');
            } finally {
                editProductSpinner.innerHTML = '';
                editProductSpinner.style.display = 'none'; // –ü—Ä–∏—Ö–æ–≤–∞—Ç–∏ —Å–ø—ñ–Ω–µ—Ä
            }
        }

        // --- –§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª –≤–ª–∞—Å–Ω–æ–≥–æ –ó–ê–ì–ê–õ–¨–ù–û–ì–û —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è ---
        openGeneralNotifyModalBtn.addEventListener('click', () => {
            notifyMessageText.value = '';
            notifyImageFile.value = '';
            notifyError.classList.add('hidden');
            customNotifyModal.classList.add('dialog-show');
        });

        notifyCancelBtn.addEventListener('click', () => {
            customNotifyModal.classList.remove('dialog-show');
            notifyError.classList.add('hidden');
        });

        customNotifyForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            notifyError.classList.add('hidden');

            const messageText = notifyMessageText.value.trim();
            if (!messageText) {
                notifyError.textContent = '–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å —Ç–µ–∫—Å—Ç –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è.';
                notifyError.classList.remove('hidden');
                return;
            }

            notifySendBtn.disabled = true;
            notifySendBtn.innerHTML = '<div id="api-spinner"></div> –í—ñ–¥–ø—Ä–∞–≤–∫–∞...';
            notifySendBtn.querySelector('#api-spinner').style.display = 'inline-block'; // –ü–æ–∫–∞–∑–∞—Ç–∏ —Å–ø—ñ–Ω–µ—Ä

            try {
                const formData = new FormData();
                formData.append('action', 'send_custom_notification');
                formData.append('message_text', messageText);
                if (notifyImageFile.files.length > 0) {
                    formData.append('image_file', notifyImageFile.files[0]);
                }

                const response = await fetch(API_BASE_URL, {
                    method: 'POST',
                    body: formData
                });
                const result = await response.json();

                if (result.status === 'success') {
                    showAlert('–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è —É—Å–ø—ñ—à–Ω–æ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ –ø—ñ–¥–ø–∏—Å–Ω–∏–∫–∞–º!');
                    customNotifyModal.classList.remove('dialog-show');
                } else {
                    throw new Error(result.message || '–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤—ñ–¥–ø—Ä–∞–≤—Ü—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è.');
                }
            } catch (error) {
                console.error('Custom Notify Error:', error);
                notifyError.textContent = `–ü–æ–º–∏–ª–∫–∞: ${error.message}`;
                notifyError.classList.remove('hidden');
            } finally {
                notifySendBtn.disabled = false;
                notifySendBtn.innerHTML = '–í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏';
                notifySendBtn.querySelector('#api-spinner').style.display = 'none'; // –ü—Ä–∏—Ö–æ–≤–∞—Ç–∏ —Å–ø—ñ–Ω–µ—Ä
            }
        });

        // --- –§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª —ñ–º–ø–æ—Ä—Ç—É CSV ---
        importCsvForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            importCsvError.classList.add('hidden');
            importCsvSuccess.classList.add('hidden');

            const file = csvFileInput.files[0];
            if (!file) {
                importCsvError.textContent = '–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–∏–±–µ—Ä—ñ—Ç—å CSV-—Ñ–∞–π–ª.';
                importCsvError.classList.remove('hidden');
                return;
            }

            const confirmed = await showConfirm(`–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ —ñ–º–ø–æ—Ä—Ç—É–≤–∞—Ç–∏ —Ç–æ–≤–∞—Ä–∏ –∑ —Ñ–∞–π–ª—É "${file.name}"? –Ü—Å–Ω—É—é—á—ñ —Ç–æ–≤–∞—Ä–∏ –∑ —Ç–∞–∫–∏–º–∏ –∂ –Ω–∞–∑–≤–∞–º–∏ –±—É–¥—É—Ç—å –æ–Ω–æ–≤–ª–µ–Ω—ñ.`);
            if (!confirmed) return;

            importCsvBtn.disabled = true;
            importCsvSpinner.innerHTML = '<div id="api-spinner"></div> –Ü–º–ø–æ—Ä—Ç...';
            importCsvSpinner.style.display = 'inline-block'; // –ü–æ–∫–∞–∑–∞—Ç–∏ —Å–ø—ñ–Ω–µ—Ä

            try {
                const formData = new FormData();
                formData.append('action', 'import_products_csv');
                formData.append('csv_file', file);

                const response = await fetch(API_BASE_URL, {
                    method: 'POST',
                    body: formData
                });
                
                // –°–ø—Ä–æ–±—É—î–º–æ –æ—Ç—Ä–∏–º–∞—Ç–∏ —Ç–µ–∫—Å—Ç–æ–≤—É –≤—ñ–¥–ø–æ–≤—ñ–¥—å, —è–∫—â–æ JSON –ø–∞—Ä—Å–∏–Ω–≥ –Ω–µ –≤–¥–∞—î—Ç—å—Å—è
                const responseText = await response.text();
                let result;
                try {
                    result = JSON.parse(responseText);
                } catch (jsonError) {
                    console.error('JSON Parse Error:', jsonError);
                    console.error('Server Response Text:', responseText);
                    throw new Error(`–°–µ—Ä–≤–µ—Ä –ø–æ–≤–µ—Ä–Ω—É–≤ –Ω–µ–≤–∞–ª—ñ–¥–Ω–∏–π JSON. –í—ñ–¥–ø–æ–≤—ñ–¥—å: ${responseText.substring(0, 200)}...`);
                }


                if (result.status === 'success') {
                    importCsvSuccess.textContent = `–Ü–º–ø–æ—Ä—Ç —É—Å–ø—ñ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–æ! –î–æ–¥–∞–Ω–æ: ${result.added_count}, –û–Ω–æ–≤–ª–µ–Ω–æ: ${result.updated_count}.`;
                    importCsvSuccess.classList.remove('hidden');
                    csvFileInput.value = ''; // –û—á–∏—Å—Ç–∏—Ç–∏ –ø–æ–ª–µ —Ñ–∞–π–ª—É
                    await fetchProducts(); // –û–Ω–æ–≤–∏—Ç–∏ —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä—ñ–≤
                    if (isAdminLoggedIn) {
                        renderAdminProducts(); // –ü–µ—Ä–µ—Ä–µ–Ω–¥–µ—Ä–∏–º–æ –∞–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å
                    }
                } else if (result.status === 'warning') {
                    importCsvError.textContent = `–Ü–º–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–æ –∑ –ø–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è–º–∏: ${result.message}`;
                    importCsvError.classList.remove('hidden');
                    csvFileInput.value = '';
                    await fetchProducts();
                    if (isAdminLoggedIn) {
                        renderAdminProducts(); // –ü–µ—Ä–µ—Ä–µ–Ω–¥–µ—Ä–∏–º–æ –∞–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å
                    }
                }
                else {
                    throw new Error(result.message || '–ü–æ–º–∏–ª–∫–∞ —ñ–º–ø–æ—Ä—Ç—É CSV.');
                }
            } catch (error) {
                console.error('CSV Import Error:', error);
                importCsvError.textContent = `–ü–æ–º–∏–ª–∫–∞ —ñ–º–ø–æ—Ä—Ç—É: ${error.message}`;
                importCsvError.classList.remove('hidden');
            } finally {
                importCsvBtn.disabled = false;
                importCsvSpinner.innerHTML = '';
                importCsvSpinner.style.display = 'none'; // –ü—Ä–∏—Ö–æ–≤–∞—Ç–∏ —Å–ø—ñ–Ω–µ—Ä
            }
        });

        // –§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª –µ–∫—Å–ø–æ—Ä—Ç—É –∑—Ä–∞–∑–∫–∞ CSV
        exportCsvSampleBtn.addEventListener('click', () => {
            const headers = "–ù–∞–∑–≤–∞ –ø—Ä–æ–¥—É–∫—Ç—É,—Ü—ñ–Ω–∞ –∑–∞ —à—Ç—É–∫—É,–∫—ñ–ª—å–∫—ñ—Å—Ç—å,–∞–∫—Ü—ñ—è —è–∫—à–æ —î (1/0),–≤—ñ–¥—Å–æ—Ç–æ–∫ –∑–Ω–∏–∂–∫–∏,–æ–ø–∏—Å,URL –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è";
            const sampleData = [
                "–ü—Ä–∏–∫–ª–∞–¥ —Ç–æ–≤–∞—Ä—É 1,120.00,10,1,15,–ö–æ—Ä–æ—Ç–∫–∏–π –æ–ø–∏—Å —Ç–æ–≤–∞—Ä—É 1,https://example.com/image1.jpg",
                "–ü—Ä–∏–∫–ª–∞–¥ —Ç–æ–≤–∞—Ä—É 2,250.50,5,0,0,–ö–æ—Ä–æ—Ç–∫–∏–π –æ–ø–∏—Å —Ç–æ–≤–∞—Ä—É 2,https://example.com/image2.png",
                "–ü—Ä–∏–∫–ª–∞–¥ —Ç–æ–≤–∞—Ä—É 3,50.00,20,1,10,–ö–æ—Ä–æ—Ç–∫–∏–π –æ–ø–∏—Å —Ç–æ–≤–∞—Ä—É 3,https://example.com/image3.webp"
            ];
            const csvContent = headers + "\n" + sampleData.join("\n");
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement("a");
            if (link.download !== undefined) { // Feature detection
                const url = URL.createObjectURL(blob);
                link.setAttribute("href", url);
                link.setAttribute("download", "sample_products.csv");
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
            showAlert('–ó—Ä–∞–∑–æ–∫ CSV-—Ñ–∞–π–ª—É —É—Å–ø—ñ—à–Ω–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ!');
        });

        // --- –§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª —Å–ø–∏—Å–∫—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ ---
        async function fetchCustomers() {
            adminCustomersList.innerHTML = '<p class="text-gray-500">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤...</p>';
            try {
                const response = await fetch(API_BASE_URL + '?action=get_telegram_users');
                const data = await response.json();
                if (data.status === 'success') {
                    customers = data.data;
                    renderCustomers();
                } else {
                    console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤:', data.message);
                    adminCustomersList.innerHTML = `<p class="text-red-500">–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤: ${data.message}</p>`;
                }
            } catch (error) {
                console.error('Fetch Customers Error:', error);
                adminCustomersList.innerHTML = `<p class="text-red-500">–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤: ${error.message}</p>`;
            }
        }

        function renderCustomers() {
            adminCustomersList.innerHTML = '';
            if (customers.length === 0) {
                adminCustomersList.innerHTML = '<p class="text-gray-500">–ù–µ–º–∞—î –∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ Telegram.</p>';
                return;
            }

            customers.forEach(customer => {
                const item = document.createElement('div');
                item.className = 'customer-item';
                item.innerHTML = `
                    <div class="customer-details">
                        <div class="username">@${customer.telegram_username}</div>
                        <div class="chat-id">Chat ID: <code>${customer.telegram_chat_id}</code></div>
                    </div>
                `;
                adminCustomersList.appendChild(item);
            });
        }

        refreshCustomersBtn.addEventListener('click', fetchCustomers);

        // NEW: –§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è–º–∏
        async function fetchOrders() {
            adminOrdersList.innerHTML = '<p class="text-gray-500">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω—å...</p>';
            try {
                let url = API_BASE_URL + '?action=get_orders';
                const statusFilter = orderStatusFilter.value;
                if (statusFilter) {
                    url += '&status=' + encodeURIComponent(statusFilter);
                }

                const response = await fetch(url);
                const data = await response.json();
                if (data.status === 'success') {
                    orders = data.data;
                    renderAdminOrdersList();
                } else {
                    console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω—å:', data.message);
                    adminOrdersList.innerHTML = `<p class="text-red-500">–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω—å: ${data.message}</p>`;
                }
            } catch (error) {
                console.error('Fetch Orders Error:', error);
                adminOrdersList.innerHTML = `<p class="text-red-500">–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω—å: ${error.message}</p>`;
            }
        }

        function renderAdminOrdersList() {
            adminOrdersList.innerHTML = '';
            if (orders.length === 0) {
                adminOrdersList.innerHTML = '<p class="text-gray-500">–ù–µ–º–∞—î –∑–∞–º–æ–≤–ª–µ–Ω—å –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è.</p>';
                return;
            }

            orders.forEach(order => {
                const orderElement = document.createElement('div');
                orderElement.className = 'order-item';
                orderElement.innerHTML = `
                    <div class="order-header">
                        <span class="order-id">–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è ‚Ññ${order.id}</span>
                        <span class="order-status ${order.status}">${order.status === 'New' ? '–ù–æ–≤–µ' : (order.status === 'Confirmed' ? '–ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–æ' : '–°–∫–∞—Å–æ–≤–∞–Ω–æ')}</span>
                    </div>
                    <div class="order-details">
                        <p><strong>–ü–æ–∫—É–ø–µ—Ü—å:</strong> ${order.customer_name} (@${order.customer_telegram})</p>
                        <p><strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong> ${order.customer_phone}</p>
                        <p><strong>–î–æ—Å—Ç–∞–≤–∫–∞:</strong> ${order.needs_delivery ? `–¢–∞–∫, –∫—ñ–º–Ω–∞—Ç–∞ ${order.customer_address}` : '–ù—ñ'}</p>
                        <p><strong>–°—É–º–∞:</strong> ${order.total_amount.toFixed(2)} –≥—Ä–Ω</p>
                        <p><strong>–î–∞—Ç–∞:</strong> ${new Date(order.created_at).toLocaleString('uk-UA')}</p>
                    </div>
                    <div class="order-items-summary">
                        <strong>–¢–æ–≤–∞—Ä–∏:</strong> ${order.items_summary.replace(/;/g, '<br>‚Äî')}
                    </div>
                    <div class="order-actions">
                        ${order.status === 'New' ? `
                            <button class="primary-btn bg-success-green hover:bg-green-600 shadow-green-700 confirm-order-btn" data-id="${order.id}">–ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏</button>
                            <button class="primary-btn bg-danger-red hover:bg-red-600 shadow-red-700 cancel-order-btn" data-id="${order.id}">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
                        ` : (order.status === 'Confirmed' ? `
                            <button class="primary-btn bg-danger-red hover:bg-red-600 shadow-red-700 cancel-order-btn" data-id="${order.id}">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
                        ` : '')}
                    </div>
                `;
                adminOrdersList.appendChild(orderElement);
            });

            document.querySelectorAll('.confirm-order-btn').forEach(btn => {
                btn.addEventListener('click', async (e) => {
                    const orderId = e.currentTarget.dataset.id;
                    const confirmed = await showConfirm(`–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è ‚Ññ${orderId}?`);
                    if (confirmed) {
                        updateOrderStatus(orderId, 'Confirmed');
                    }
                });
            });

            document.querySelectorAll('.cancel-order-btn').forEach(btn => {
                btn.addEventListener('click', async (e) => {
                    const orderId = e.currentTarget.dataset.id;
                    const confirmed = await showConfirm(`–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ —Å–∫–∞—Å—É–≤–∞—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è ‚Ññ${orderId}? –¢–æ–≤–∞—Ä–∏ –±—É–¥—É—Ç—å –ø–æ–≤–µ—Ä–Ω–µ–Ω—ñ –Ω–∞ —Å–∫–ª–∞–¥.`);
                    if (confirmed) {
                        updateOrderStatus(orderId, 'Cancelled');
                    }
                });
            });
        }

        async function updateOrderStatus(orderId, newStatus) {
            try {
                const formData = new FormData();
                formData.append('action', 'update_order_status');
                formData.append('order_id', orderId);
                formData.append('status', newStatus);

                const response = await fetch(API_BASE_URL, {
                    method: 'POST',
                    body: formData
                });
                const result = await response.json();

                if (result.status === 'success') {
                    showAlert(`–°—Ç–∞—Ç—É—Å –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è ‚Ññ${orderId} —É—Å–ø—ñ—à–Ω–æ –æ–Ω–æ–≤–ª–µ–Ω–æ –Ω–∞ "${newStatus}".`);
                    fetchOrders(); // –û–Ω–æ–≤–∏—Ç–∏ —Å–ø–∏—Å–æ–∫ –∑–∞–º–æ–≤–ª–µ–Ω—å
                    fetchProducts(); // –û–Ω–æ–≤–∏—Ç–∏ —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä—ñ–≤, —è–∫—â–æ –±—É–ª–∏ –∑–º—ñ–Ω–∏ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ
                } else {
                    throw new Error(result.message || '–ü–æ–º–∏–ª–∫–∞ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–∞—Ç—É—Å—É –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è.');
                }
            } catch (error) {
                console.error('Update Order Status Error:', error);
                showAlert(`–ü–æ–º–∏–ª–∫–∞ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–∞—Ç—É—Å—É –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è: ${error.message}`);
            }
        }

        orderStatusFilter.addEventListener('change', fetchOrders);
        refreshOrdersBtn.addEventListener('click', fetchOrders);

        // NEW: –§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª –¥–ª—è –ø–µ—Ä—à–æ–≥–æ –≤—ñ–¥–≤—ñ–¥—É–≤–∞–Ω–Ω—è
        function showFirstVisitMessage() {
            if (!localStorage.getItem('firstVisitDone')) {
                firstVisitDialog.classList.add('dialog-show');
            }
        }

        firstVisitOkBtn.addEventListener('click', () => {
            firstVisitDialog.classList.remove('dialog-show');
            localStorage.setItem('firstVisitDone', 'true');
        });


        // --- –Ü–ù–Ü–¶–Ü–ê–õ–Ü–ó–ê–¶–Ü–Ø ---

        async function init() {
            // –û–±—Ä–æ–±–Ω–∏–∫ –¥–ª—è –∑–º—ñ–Ω–∏ —Ö–µ—à—É URL
            window.addEventListener('hashchange', () => {
                const currentHash = window.location.hash;
                if (currentHash === ADMIN_SECRET_PATH) {
                    showPage('admin');
                } else if (currentHash === '#cart') {
                    showPage('cart');
                } else {
                    showPage('products');
                }
            });

            // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è —Å—Ç–æ—Ä—ñ–Ω–∫–∏ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ
            const initialHash = window.location.hash;
            if (initialHash === ADMIN_SECRET_PATH) {
                showPage('admin');
            } else if (initialHash === '#cart') {
                showPage('cart');
            } else {
                showPage('products');
            }

            await fetchCategories(); // –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó –¥–ª—è —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó
            await fetchProducts(); // –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ —Ç–æ–≤–∞—Ä–∏
            showFirstVisitMessage(); // –ü–æ–∫–∞–∑–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–µ—Ä—à–µ –≤—ñ–¥–≤—ñ–¥—É–≤–∞–Ω–Ω—è
        }

        init();
    </script>
</body>

</html>
